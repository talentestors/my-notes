---
# å½“å‰é¡µé¢å†…å®¹æ ‡é¢˜
title: Javaç½‘ç»œç¼–ç¨‹
# å½“å‰é¡µé¢å›¾æ ‡
icon: change
# åˆ†ç±»
category:
  - javase
  - ç½‘ç»œç¼–ç¨‹
# æ ‡ç­¾
tag:
  - javase
  - socket
sticky: false
# æ˜¯å¦æ”¶è—åœ¨åšå®¢ä¸»é¢˜çš„æ–‡ç« åˆ—è¡¨ä¸­ï¼Œå½“å¡«å…¥æ•°å­—æ—¶ï¼Œæ•°å­—è¶Šå¤§ï¼Œæ’åè¶Šé å‰ã€‚
star: false
# æ˜¯å¦å°†è¯¥æ–‡ç« æ·»åŠ è‡³æ–‡ç« åˆ—è¡¨ä¸­
article: false
# æ˜¯å¦å°†è¯¥æ–‡ç« æ·»åŠ è‡³æ—¶é—´çº¿ä¸­
timeline: false
---

ç½‘ç»œç¼–ç¨‹æ˜¯æŒ‡ç¼–å†™è¿è¡Œåœ¨å¤šä¸ªè®¾å¤‡ï¼ˆè®¡ç®—æœºï¼‰çš„ç¨‹åºï¼Œè¿™äº›è®¾å¤‡éƒ½é€šè¿‡ç½‘ç»œè¿æ¥èµ·æ¥ã€‚ç¨‹åºä¹‹é—´å¯ä»¥é€šä¿¡ï¼Œäº’ç›¸å‘é€æ¶ˆæ¯ï¼Œç½‘ç»œç¼–ç¨‹å…¶å®æ˜¯æœ‰éš¾åº¦çš„ï¼Œä½†æ˜¯Javaä½œä¸ºä¸€ä¸ªé¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œå¸®åŠ©æˆ‘ä»¬å±è”½äº†å¤§é‡çš„å¤æ‚å®ç°ï¼Œæˆ‘ä»¬å­¦èµ·æ¥ï¼Œå°±ç®€å•äº†ã€‚

Javaä¸­æä¾›äº† java\.net åŒ…ä¸­ J2SE çš„ API åŒ…å«æœ‰ç±»å’Œæ¥å£ï¼Œå®ƒä»¬æä¾›ä½å±‚æ¬¡çš„é€šä¿¡ç»†èŠ‚ã€‚ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›ç±»å’Œæ¥å£ï¼Œæ¥ä¸“æ³¨äºè§£å†³é—®é¢˜ï¼Œè€Œä¸ç”¨å…³æ³¨é€šä¿¡ç»†èŠ‚ã€‚å½“ç„¶å­¦ä¹ è¿™äº›ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ‰«æ‰«ç›²ï¼Œå­¦ä¹ ä¸€äº›ç½‘ç»œçš„åŸºæœ¬çŸ¥è¯†ã€‚

## ä¸€ã€ç½‘ç»œåŸºæœ¬æ¦‚å¿µ

### 1ã€ç½‘å¡

ç½‘å¡æ˜¯ä¸€å—è¢«è®¾è®¡ç”¨æ¥å…è®¸è®¡ç®—æœºåœ¨è®¡ç®—æœºç½‘ç»œä¸Šè¿›è¡Œé€šè®¯çš„è®¡ç®—æœºç¡¬ä»¶ã€‚

![image-20210914114831443](./img/image-20210914114831443-d1235758.png)

 æ¯ä¸€ä¸ªç½‘å¡éƒ½æœ‰ä¸€ä¸ªè¢«ç§°ä¸ºMACåœ°å€çš„ç‹¬ä¸€æ— äºŒçš„48ä½ä¸²è¡Œå·ï¼Œå®ƒè¢«å†™åœ¨å¡ä¸Šçš„ä¸€å—å†…å­˜ä¸­ã€‚åœ¨ç½‘ç»œä¸Šçš„æ¯ä¸€ä¸ªè®¡ç®—æœºéƒ½å¿…é¡»æ‹¥æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„MACåœ°å€ã€‚

 æ²¡æœ‰ä»»ä½•ä¸¤å—è¢«ç”Ÿäº§å‡ºæ¥çš„ç½‘å¡æ‹¥æœ‰åŒæ ·çš„åœ°å€ã€‚è¿™æ˜¯å› ä¸ºç”µæ°”ç”µå­å·¥ç¨‹å¸ˆåä¼šè´Ÿè´£ä¸ºç½‘ç»œæ¥å£æ§åˆ¶å™¨ï¼ˆç½‘å¡ï¼‰é”€å”®å•†åˆ†é…å”¯ä¸€çš„MACåœ°å€ã€‚

### 2ã€MACåœ°å€ã€IPåœ°å€

windowç”µè„‘åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹è¾“å…¥å‘½ä»¤ï¼š

æ€ä¹ˆè¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ï¼ŒæŒ‰ win+Rï¼Œè¾“å…¥cmdå³å¯

![image-20210813150521017](./img/image-20210813150521017-41bf0fc3.png)

```bash
ipconfig -all
```

ä¼šçœ‹åˆ°ï¼š

```bash
æ— çº¿å±€åŸŸç½‘é€‚é…å™¨ WLAN:

   æè¿°. . . . . . . . . . . . . . . : Intel(R) Wi-Fi 6 AX201 160MHz
   ç‰©ç†åœ°å€. . . . . . . . . . . . . : 8C-C6-81-54-FF-9C
   IPv4 åœ°å€ . . . . . . . . . . . . : 192.168.0.109(é¦–é€‰)
   å­ç½‘æ©ç   . . . . . . . . . . . . : 255.255.255.0
```

 å…¶ä¸­ç‰©ç†åœ°å€æŒ‡çš„å°±æ˜¯MACåœ°å€ã€IPv4 åœ°å€å°±æ˜¯IPã€‚

 MACåœ°å€ä¹Ÿå«ç‰©ç†åœ°å€å’Œå±€åŸŸç½‘åœ°å€ï¼Œä¸»è¦ç”¨äºç¡®è®¤ç½‘ä¸Šè®¾å¤‡çš„åœ°å€ï¼Œç±»ä¼¼äº`èº«ä»½è¯å·`ï¼Œå…·æœ‰å”¯ä¸€æ ‡è¯†ï¼Œæ¯ä¸€ä¸ªç½‘å¡åˆ¶ä½œå®Œæˆä¹‹åå°±å¸¦æœ‰ä¸€ä¸ªMACåœ°å€ï¼Œæ°¸è¿œéƒ½ä¸ä¼šæ”¹å˜ã€‚

 IPåœ°å€ï¼Œç±»ä¼¼äºä½ çš„ç°ä½å€ï¼Œæ˜¯æ ‡è®°ä½ åœ¨ç½‘ç»œä¸­çš„å…·ä½“ä½ç½®ï¼Œä¸€ä¸ªç½‘å¡çš„IPåœ°å€æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚

IPåœ°å€çš„è¡¨ç¤ºæ–¹å¼ï¼š32ä½

åŸå§‹

```text
01111111.00000000.00000000.00000001
```

åè¿›åˆ¶è¡¨ç¤º

```text
127.0.0.1
```

### 3ã€è®¡ç®—æœºä¹‹é—´æ˜¯æ€ä¹ˆå‘é€æ•°æ®çš„

æˆ‘ä»¬ä¸æ˜¯ç½‘ç»œçš„é€šè¯†æ•™è‚²ï¼Œæ‰€ä»¥è¿™é‡Œçš„è®²è§£ï¼Œä»¥ç®€å•ã€é€šä¿—æ˜“æ‡‚ä¸ºä¸»ã€‚

#### ï¼ˆ1ï¼‰ åŒç»çº¿

å¦‚æœåªæ˜¯ä¸¤å°è®¡ç®—æœºï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨åŒç»çº¿ï¼ˆç½‘çº¿ï¼‰è¿è½½ä¸€èµ·ï¼Œå°±èƒ½äº’ç›¸å‘é€æ¶ˆæ¯ï¼Œç»„æˆä¸€ä¸ªå°ç½‘ç»œã€‚

![image-20210813150542149](./img/image-20210813150542149-8297fa44.png)

#### ï¼ˆ2ï¼‰ äº¤æ¢æœº

 ä½†æ˜¯æˆ‘ä»¬çš„ç½‘ç»œä¸æ˜¯ç”±ä¸¤å°ç”µè„‘ç»„æˆçš„ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å°†å‡ åå°ä¸Šç™¾å°ç”µè„‘ç»„ç»‡èµ·æ¥å½¢æˆä¸€ä¸ªå±€åŸŸç½‘ï¼Œæ­¤æ—¶ä¸€ä¸ªæ–°çš„è®¾å¤‡å°±å‡ºç°äº†å«åšäº¤æ¢æœºï¼ˆswitchï¼‰ã€‚

 äº¤æ¢æœºå¯ä»¥è®°å½•æ¯ä¸€ä¸ªè®¾å¤‡çš„åœ°å€å’Œæ¥å£çš„å¯¹åº”å…³ç³»ï¼Œä»è€Œå®ç°ç«¯å¯¹ç«¯çš„ä¿¡æ¯ä¼ è¾“ã€‚

 æ€è€ƒé—®é¢˜ï¼Œäº¤æ¢æœºè¦å°†å†…å®¹å‘é€ç»™æŒ‡å®šçš„è®¡ç®—æœºï¼Œé‚£ä¹ˆå†…éƒ¨ä¸€å®šç»´æŠ¤äº†ä¸€å¼ è¡¨ï¼Œè®°å½•äº†å“ªä¸ªç”µè„‘é“¾æ¥äº†æˆ‘çš„å“ªä¸ªå£ã€‚äº¤æ¢æœºåªèƒ½è¯†åˆ«MACåœ°å€ã€‚MACåœ°å€æ˜¯ã€ç‰©ç†åœ°å€ã€‘ï¼Œäº¤æ¢æœºå¯¹ã€IPåœ°å€ã€‘å¹¶ä¸æ„Ÿå…´è¶£ã€‚

![image-20210813150631723](./img/image-20210813150631723-f432fcd5.png)

æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š

äº¤æ¢æœºæ˜¯æ€ä¹ˆçŸ¥é“è¿™ä¸ªè¡¨çš„ï¼š

![image-20210813150706819](./img/image-20210813150706819-65417cf0.png)

äº¤æ¢æœºæ•ˆç‡æ¯”è¾ƒé«˜ï¼Œè€Œä¸”å¯ä»¥è¿›è¡Œæ¡¥æ¥ã€‚

![image-20210813150719333](./img/image-20210813150719333-bba05e02.png)

#### ï¼ˆ3ï¼‰è·¯ç”±å™¨

 æ€è€ƒï¼šä½¿ç”¨äº¤æ¢æœºå¯ä»¥å»ºç«‹ä¸€ä¸ªè¶…å¤§å‹çš„ç½‘ç»œå—ï¼Ÿ

 ä¸€èˆ¬çš„äº¤æ¢æœºçš„åœ°å€è¡¨ä¹Ÿå°±èƒ½å­˜ä¸ªå‡ åƒä¸ªåœ°å€ï¼Œå½“ç½‘ç»œå†…çš„è®¾å¤‡å¤šèµ·æ¥ä»¥åï¼Œåªè¦äº¤æ¢æœºæ‰¾ä¸åˆ°å¯¹åº”è®¾å¤‡å°±ä¼šå¹¿æ’­ï¼Œåœ°å€è¡¨å¦‚æœæ»¡äº†ï¼Œæ–°åœ°å€è¿˜ä¼šè¦†ç›–æ—§åœ°å€å°±ä¼šå¯¼è‡´é‡æ–°å¯»æ‰¾æ•ˆç‡æ¯”è¾ƒä½ã€‚æ‰€ä»¥åˆå¼•å…¥äº†ä¸€ä¸ªè®¾å¤‡å«ã€è·¯ç”±å™¨ã€‘ï¼Œè°ä¹Ÿå¬è¿‡çš„ä¸€ä¸ªè®¾å¤‡ï¼Œä¸€èˆ¬å®¶é‡Œéƒ½æœ‰ã€‚

 æ³¨æ„ï¼šè·¯ç”±å™¨ä¸æ˜¯çŒ«ï¼ŒçŒ«æ˜¯è°ƒåˆ¶è§£è°ƒå™¨ã€‚å®ƒèƒ½æŠŠè®¡ç®—æœºçš„ã€æ•°å­—ä¿¡å·ã€‘ç¿»è¯‘æˆå¯æ²¿ã€æ™®é€šç”µè¯çº¿/å…‰çº¤ã€‘ä¼ é€çš„æ¨¡æ‹Ÿä¿¡å·ï¼Œè€Œè¿™äº›æ¨¡æ‹Ÿä¿¡å·åˆå¯è¢«çº¿è·¯å¦ä¸€ç«¯çš„å¦ä¸€ä¸ªè°ƒåˆ¶è§£è°ƒå™¨æ¥æ”¶ï¼Œå¹¶è¯‘æˆè®¡ç®—æœºå¯æ‡‚çš„ã€è¯­è¨€ã€‘ã€‚ä½†æ˜¯è¿è¥å•†é€ä½ çš„ç›’å­ä¸€èˆ¬æ—¢æœ‰è°ƒåˆ¶è§£è°ƒå™¨çš„åŠŸèƒ½ï¼Œä¹Ÿæœ‰è·¯ç”±å™¨çš„åŠŸèƒ½ï¼Œåªä¸è¿‡è·¯ç”±åŠŸèƒ½ä¸å¤ªå¥½ã€‚

åŸºäºè·¯ç”±å™¨ï¼Œæˆ‘ä»¬æå‡ºäº†ä»¥ä¸‹çš„è®¾è®¡ï¼š

![image-20210813150741372](./img/image-20210813150741372-63c1bc97.png)

 è¿™é‡Œå°±æœ‰äº†ç½‘ç»œçš„æ¦‚å¿µäº†ã€‚ä»¥ä¸Šçš„å‡ ç§ï¼Œå“ªæ€•æ˜¯äº¤æ¢æœºçš„æ¡¥æ¥ä¹Ÿæ²¡æœ‰æ¶‰åŠIPåœ°å€è¿™ä¸ªæ¦‚å¿µï¼Œéƒ½æ˜¯åŸºäºMACåœ°å€è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚è¿™é‡Œæœ‰äº†ç½‘ç»œè¿™ä¸ªæŠ½è±¡æ¦‚å¿µä¹‹åIPåœ°å€å°±åº”è¿è€Œç”Ÿäº†ï¼ŒIPåœ°å€åªæ˜¯ç”¨æ¥è¡¨ç¤ºè®¡ç®—æœºçš„ç½‘ç»œä½ç½®ï¼Œå®ƒå¤„äºå“ªä¸€ä¸ªç½‘ç»œã€‚IPåœ°å€å’Œå­ç½‘æ©ç å…±åŒå¸®åŠ©æˆ‘ä»¬å®šä½ä¸€ä¸ªè®¡ç®—æœºåœ¨ç½‘ç»œä¸­çš„ä½ç½®ã€‚

 IPåœ°å€å’Œå­ç½‘æ©ç å…¶å®æ˜¯ä¸ª32ä½çš„äºŒè¿›åˆ¶æ•°å­—ï¼š

![image-20210813150801640](./img/image-20210813150801640-dbe09114.png)

æ­¤æ—¶å‘é€ä¿¡æ¯å°±ä¼šå†åŒ…ä¸€ä¸ªæ¶ˆæ¯çš„å¤´éƒ¨

![image-20210813150819122](./img/image-20210813150819122-3b9a01ef.png)

 å®¶ç”¨çš„è·¯ç”±å™¨ï¼Œæœ‰ä¸€ä¸ªWANå£ï¼Œæœ‰å¥½å‡ ä¸ªLANå£ï¼Œwanå£ç”¨æ¥è¿æ¥äº’è”ç½‘ç«¯ï¼ŒLANç”¨æ¥è¿æ¥å®¶åº­è®¾å¤‡ã€‚ä¿¡æ¯åœ¨ç½‘ç»œä¼ æ’­ï¼Œä¾ç„¶éœ€è¦ä¾é MACåœ°å€ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªARPåè®®ï¼Œå°±æ˜¯ç”¨æ¥é€šè¿‡IPæŸ¥æ‰¾MACåœ°å€çš„ã€‚

![image-20210813150835776](./img/image-20210813150835776-b0b1527b.png)

æ¥ä¸€ä¸ªæ —å­ï¼Œ192.168.100.100 å‘é€ä¿¡æ¯åˆ° 192.168.200.101

![image-20210813150854976](./img/image-20210813150854976-9f3ee8f4.png)

> è¿™ç§å› ç‰¹ç½‘IPåœ°å€ä¸­ç‰¹å®šçš„ä¸“ç”¨åœ°å€æ˜¯ä¸ä½œåˆ†é…çš„ï¼š

â‘ ä¸»æœºå·å…¨ä¸ºâ€œ0â€ã€‚ä¸è®ºå“ªä¸€ç±»ç½‘ç»œï¼Œä¸»æœºå·å…¨ä¸ºâ€œ0â€è¡¨ç¤ºæŒ‡å‘æœ¬ç½‘ï¼Œå¸¸ç”¨åœ¨è·¯ç”±è¡¨ä¸­ï¼›

â‘¡ä¸»æœºå·å…¨ä¸ºâ€œ1â€ã€‚ä¸»æœºå·å…¨ä¸ºâ€œ1â€è¡¨ç¤ºå¹¿æ’­åœ°å€ï¼Œå‘ç‰¹å®šçš„æ‰€åœ¨ç½‘ä¸Šçš„æ‰€æœ‰ä¸»æœºå‘é€æ•°æ®åŒ…ã€‚

 IPåœ°å€åˆ†ä¸ºäº”ç±»ï¼ŒAç±»ä¿ç•™ç»™æ”¿åºœæœºæ„ï¼ŒBç±»åˆ†é…ç»™ä¸­ç­‰è§„æ¨¡çš„å…¬å¸ï¼ŒCç±»åˆ†é…ç»™ä»»ä½•éœ€è¦çš„äººï¼ŒDç±»ç”¨äºç»„æ’­ï¼ŒEç±»ç”¨äºå®éªŒï¼Œå„ç±»å¯å®¹çº³çš„åœ°å€æ•°ç›®ä¸åŒã€‚

 Aã€Bã€Cä¸‰ç±»IPåœ°å€çš„ç‰¹å¾ï¼šå½“å°†IPåœ°å€å†™æˆäºŒè¿›åˆ¶å½¢å¼æ—¶ï¼ŒAç±»åœ°å€çš„ç¬¬ä¸€ä½æ€»æ˜¯Oï¼ŒBç±»åœ°å€çš„å‰ä¸¤ä½æ€»æ˜¯10ï¼ŒCç±»åœ°å€çš„å‰ä¸‰ä½æ€»æ˜¯110ã€‚

> Aç±»åœ°å€

1. Aç±»åœ°å€ç¬¬1å­—èŠ‚ä¸ºç½‘ç»œåœ°å€ï¼Œå…¶å®ƒ3ä¸ªå­—èŠ‚ä¸ºä¸»æœºåœ°å€ã€‚
2. Aç±»åœ°å€èŒƒå›´ï¼š1.0.0.1â€”126.255.255.254
3. Aç±»åœ°å€ä¸­çš„ç§æœ‰åœ°å€å’Œä¿ç•™åœ°å€ï¼Œ10.X.X.Xæ˜¯ç§æœ‰åœ°å€ï¼ˆæ‰€è°“çš„ç§æœ‰åœ°å€å°±æ˜¯åœ¨äº’è”ç½‘ä¸Šä¸ä½¿ç”¨ï¼Œè€Œè¢«ç”¨åœ¨å±€åŸŸç½‘ç»œä¸­çš„åœ°å€ï¼‰ã€‚èŒƒå›´ï¼ˆ10.0.0.0-10.255.255.255ï¼‰ï¼Œ127.X.X.Xæ˜¯ä¿ç•™åœ°å€ï¼Œç”¨åšå¾ªç¯æµ‹è¯•ç”¨çš„ã€‚

> Bç±»åœ°å€

1. Bç±»åœ°å€ç¬¬1å­—èŠ‚å’Œç¬¬2å­—èŠ‚ä¸ºç½‘ç»œåœ°å€ï¼Œå…¶å®ƒ2ä¸ªå­—èŠ‚ä¸ºä¸»æœºåœ°å€ã€‚
2. Bç±»åœ°å€èŒƒå›´ï¼š128.0.0.1â€”191.255.255.254ã€‚
3. Bç±»åœ°å€çš„ç§æœ‰åœ°å€å’Œä¿ç•™åœ°å€ï¼Œ172.16.0.0â€”172.31.255.255æ˜¯ç§æœ‰åœ°å€ã€‚

> Cç±»åœ°å€

1. Cç±»åœ°å€ç¬¬1å­—èŠ‚ã€ç¬¬2å­—èŠ‚å’Œç¬¬3ä¸ªå­—èŠ‚ä¸ºç½‘ç»œåœ°å€ï¼Œç¬¬4ä¸ªå­—èŠ‚ä¸ºä¸»æœºåœ°å€ã€‚å¦å¤–ç¬¬1ä¸ªå­—èŠ‚çš„å‰ä¸‰ä½å›ºå®šä¸º110ã€‚
2. Cç±»åœ°å€èŒƒå›´ï¼š192.0.0.1â€”223.255.255.254ã€‚
3. Cç±»åœ°å€ä¸­çš„ç§æœ‰åœ°å€ï¼Œ192.168.X.Xæ˜¯ç§æœ‰åœ°å€ã€‚(192.168.0.0-192.168.255.255)

> Dç±»åœ°å€

1. Dç±»åœ°å€ä¸åˆ†ç½‘ç»œåœ°å€å’Œä¸»æœºåœ°å€ï¼Œå®ƒçš„ç¬¬1ä¸ªå­—èŠ‚çš„å‰å››ä½å›ºå®šä¸º1110ã€‚
2. Dç±»åœ°å€èŒƒå›´ï¼š224.0.0.1â€”239.255.255.254

> Eç±»åœ°å€

1. Eç±»åœ°å€ä¸åˆ†ç½‘ç»œåœ°å€å’Œä¸»æœºåœ°å€ï¼Œå®ƒçš„ç¬¬1ä¸ªå­—èŠ‚çš„å‰äº”ä½å›ºå®šä¸º11110ã€‚
2. Eç±»åœ°å€èŒƒå›´ï¼š240.0.0.1â€”255.255.255.254

### 4ã€åŸŸå

ä½ çœŸçš„èƒ½è®°ä½æ¯ä¸ªç½‘ç«™çš„IPåœ°å€å—ï¼ŸåŸŸåå°±æ˜¯IPçš„åå­—ï¼Œå¦‚æœIPæ˜¯æ‰‹æœºå·ï¼ŒåŸŸåå°±æ˜¯åå­—ã€‚

æˆ‘ä»¬å¯ä»¥å»é˜¿é‡Œäº‘ç­‰äº‘æœåŠ¡æä¾›å•†è´­ä¹°åŸŸåã€‚

![image-20210813151029438](./img/image-20210813151029438-3d7b85a9.png)

 æˆ‘ä»¬è´­ä¹°äº†åŸŸåä¹‹åï¼Œéœ€è¦åœ¨äº‘æœåŠ¡å‚å•†è¿›è¡ŒåŸŸåçš„é…ç½®ï¼Œè®©åŸŸåæŒ‡å‘ä¸€ä¸ªæ‹¥æœ‰å…¬ç½‘IPåœ°å€çš„æœåŠ¡å™¨ï¼Œä»¥åè®¿é—®åŸŸåå°±èƒ½è®¿é—®åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨äº†ã€‚

![image-20210813151052978](./img/image-20210813151052978-b5295e03.png)

#### ï¼ˆ1ï¼‰DNSæœåŠ¡å™¨

| åç§°       | ä»‹ç»                                           | DNSåœ°å€                                          |
| ---------- | ---------------------------------------------- | ------------------------------------------------ |
| 114DNS     | å›½å†…ç”¨æˆ·é‡æœ€å¤§çš„è€ç‰ŒDNS                        | é¦–é€‰ï¼š114.114.114.114 <br/>å¤‡é€‰ï¼š114.114.114.115 |
| DNSPod DNS | ä¸­å›½æœ€å¤§çš„ç¬¬ä¸‰æ–¹åŸŸåæœåŠ¡å•†ï¼Œå…¨çƒæ’åç¬¬å››ä½     | é¦–é€‰ï¼š119.29.29.29 <br/>å¤‡é€‰ï¼š182.254.116.116    |
| é˜¿é‡Œ DNS   | é˜¿é‡Œå…¬å…±DNSæ˜¯é˜¿é‡Œå·´å·´é›†å›¢æ¨å‡ºçš„DNSé€’å½’è§£æç³»ç»Ÿ | é¦–é€‰ï¼š223.5.5.5 <br/>å¤‡é€‰ï¼š223.6.6.6             |

#### ï¼ˆ2ï¼‰åŸŸåçš„åˆ†ç±»

| åˆ†ç±»æ ‡å‡† | åˆ†ç±»è¯¦æƒ…                                                     |
| -------- | ------------------------------------------------------------ |
| è¯­ç§åˆ†ç±» | ä¸­æ–‡ï¼šç™¾åº¦\.com ã€ç™¾åº¦\.ä¸­å›½ã€baidu\.ä¸­å›½ <br/>è‹±æ–‡ï¼šbaidu\.com |
| åœ°åŒºåˆ†ç±» | ä¸­å›½å¤§é™†é¡¶çº§åŸŸåæ˜¯\.cn<br/>ç¾å›½å›½å®¶é¡¶çº§åŸŸåæ˜¯\.us <br/>æ—¥æœ¬å›½å®¶é¡¶çº§åŸŸåæ˜¯\.jp |
| æœºæ„åˆ†ç±» | \.com å•†ä¸šæ€§çš„æœºæ„æˆ–å…¬å¸ <br/>\.org éç›ˆåˆ©çš„ç»„ç»‡ã€å›¢ä½“ [https://apache.org/](https://apache.org/) <br/>\.gov æ”¿åºœéƒ¨é—¨ [http://www.gov.cn/](http://www.gov.cn/) [https://www.shanghai.gov.cn/](https://www.shanghai.gov.cn/) |
| å±‚çº§åˆ†ç±» | é¡¶çº§åŸŸåï¼ˆä¸€çº§åŸŸå)ï¼š[baidu.com](http://baidu.com/) <br/>äºŒçº§åŸŸåï¼šjingyan\.baidu\.com  [www.baidu.com](http://www.baidu.com/) |

## äºŒã€æ•°æ®çš„ä¼ è¾“

### 1ã€ç½‘ç»œä¸ƒå±‚å‚è€ƒæ¨¡å‹

 è®²è¿™ä¸ªä¹‹å‰æˆ‘ä»¬å…ˆèŠèŠå†å²ï¼š

 ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬è®¤ä¸ºäº’è”ç½‘èµ·æºäºé˜¿å¸•ç½‘ï¼ˆARPANETï¼‰ï¼Œæœ€æ—©çš„é˜¿å¸•ç½‘æ˜¯éå¸¸ç®€é™‹çš„ï¼Œå®ƒä½¿ç”¨ç½‘ç»œæ§åˆ¶åè®®ï¼ˆNetWork Control Protocolï¼Œç¼©å†™NCPï¼‰é“¾æ¥ä¸åŒçš„è®¡ç®—æœºã€‚åœ¨æ„å»ºé˜¿å¸•ç½‘ä¹‹åï¼Œå…¶ä»–ä¼ è¾“åè®®çš„ç ”ç©¶æ…¢æ…¢çš„å·²ç»å¼€å§‹å±•å¼€ï¼ŒNCPè¯ç”Ÿä¸¤å¹´åï¼ŒNCPçš„å¼€å‘è€…æ¸©ç‰¹-ç‘Ÿå¤«å’Œç½—ä¼¯ç‰¹-å¡æ©ä¸€èµ·å¼€å‘äº†é˜¿å¸•ç½‘çš„ä¸‹ä¸€ä»£åè®®ï¼Œå¹¶åœ¨1974å¹´å‘è¡¨äº†ä»¥åˆ†ç»„ã€åºåˆ—åŒ–ã€æµé‡æ§åˆ¶ã€è¶…æ—¶å’Œå®¹é”™ç­‰ä¸ºæ ¸å¿ƒçš„ä¸€ç§æ–°çš„ç½‘ç»œåè®®å¥ å®šäº†TCP/IPåè®®çš„åŸºç¡€ã€‚

 ä¸æ­¤åŒæ—¶ï¼Œä¸€ä¸ªå«ã€ISOã€‘ã€ å›½é™…æ ‡å‡†åŒ–ç»„ç»‡(International Organization for Standardizationï¼Œ *ISO*) ã€çš„ç»„ç»‡å‘ç°ï¼Œè®¡ç®—æœºè®¾å¤‡çš„äº’è”äº’é€šæ˜¯ä¸€ä¸ªå€¼å¾—ç ”ç©¶çš„æ–°é¢†åŸŸï¼Œäºæ˜¯è¿™ä¸ªç»„ç»‡å‡ºé¢å’Œä¼—å¤šå‚å•†æ¸¸è¯´ï¼šâ€œæˆ‘ä»¬ä¸€èµ·å‡ºä¸€ä¸ªç½‘ç»œäº’è”äº’é€šçš„æ ‡å‡†å§ï¼Œè¿™æ ·å¤§å®¶éƒ½éµå®ˆè¿™ä¸ªæ ‡å‡†ï¼Œæˆ‘ä»¬ä¸€èµ·æŠŠè¿™ä»¶äº‹æƒ…æå¤§ï¼Œå¤§å®¶å°±éƒ½æœ‰é’±èµšäº†â€ï¼Œäºæ˜¯ISOå¬é›†äº†ä¸€å¸®äººè®¤çœŸçš„å¼€å§‹ç ”ç©¶ç½‘ç»œè”é€šï¼Œè¿™ä»¶äº‹æƒ…è¿˜çœŸæå‡ºäº†ä¸€ä¸ªéå¸¸å¼ºæ‚çš„æ ‡å‡†ï¼Œè¿™å°±æ˜¯ã€OSIï¼ˆOpen System Interconnection Reference Modelï¼‰å‚è€ƒæ¨¡å‹ã€‘ã€‚ä¸è¿‡ç­‰ä»–å‘å¸ƒçš„æ—¶å€™æ—¶å€™ï¼Œè¯¥ç»„ç»‡æƒŠè®¶çš„å‘ç°ï¼Œæ»¡ä¸–ç•Œéƒ½åœ¨ç”¨ä¸€ä¸ªå«ã€TCP/IPåè®®æ ˆã€‘çš„ä¸œè¥¿ï¼Œè€Œä¸”è·ŸOSIæ²¡æœ‰åŠæ¯›é’±çš„å…³ç³»ã€‚



äº‹å®ä¸Šæˆ‘ä»¬å‰é¢æåŠçš„ä¸¤ä½ç‰›äººå¡æ©å’Œç‘Ÿå¤«ä¸€ç›´éƒ½ä¸é—ä½™åŠ›çš„æ¨å¹¿TCP/IPï¼ŒTCP/IPæˆåŠŸä¹Ÿä¸æ˜¯å¶ç„¶çš„ï¼Œè€Œæ˜¯ç»¼åˆäº†å…¶ä»–å‡ ä¸ªå› ç´ :

- å®ƒæ˜¯å…è´¹çš„æˆ–è€…ä»…ä»…æ”¶å°‘é‡çš„è´¹ç”¨ï¼Œè¿™å°±æ˜¯å®ƒçš„ä½¿ç”¨äººç¾¤ï¼Œéå¸¸çš„å¹¿ï¼›
- TCP/IPæ­ä¸Šäº†unixè¿™è¾†å¿«è½¦ï¼Œå¹¶å¾ˆå¿«æ¨å‡ºäº†åŸºäºã€å¥—æ¥å­—ã€‘çš„å®é™…ç¼–ç¨‹æ¥å£ã€‚
- TCP/IPæ¥æºäºå®é™…éœ€æ±‚ï¼Œå®ƒç¡®å®è§£å†³äº†å½“ä¸‹çš„ç½‘ç»œäº’è¿æ ‡å‡†ã€‚

æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹ISOå‚è€ƒæ¨¡å‹å’ŒTCP/IPåè®®æ ˆçš„å¯¹åº”å…³ç³»ã€‚

![image-20210813151107369](./img/image-20210813151107369-6b343cdf.png)

| å±‚         | åŠŸèƒ½                                   | åè®®                                     |
| ---------- | -------------------------------------- | ---------------------------------------- |
| åº”ç”¨å±‚     | æä¾›åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡ã€‚               | TFTPï¼ŒHTTPï¼ŒSNMPï¼ŒFTPï¼ŒSMTPï¼ŒDNSï¼ŒTelnet |
| è¡¨ç¤ºå±‚     | å¤„ç†æ•°æ®æ ¼å¼ï¼Œæ•°æ®åŠ å¯†å’Œå‹ç¼©ç­‰ã€‚       | æ²¡æœ‰åè®®                                 |
| ä¼šè¯å±‚     | å»ºç«‹ã€ç®¡ç†ã€ç»ˆæ­¢ä¸¤ä¸»æœºçš„ä¼šè¯ã€‚         | æ²¡æœ‰åè®®                                 |
| ä¼ è¾“å±‚     | å»ºç«‹ä¸»æœºçš„ç«¯åˆ°ç«¯è¿æ¥ã€‚                 | TCPï¼ŒUDP                                 |
| ç½‘ç»œå±‚     | è·¯å¾„é€‰æ‹©ã€‚                             | ICMPï¼ŒRIPï¼ŒOSPFï¼ŒBGPï¼ŒIGMPï¼ŒIP           |
| æ•°æ®é“¾è·¯å±‚ | è´Ÿè´£ä¸¤ä¸ªç›¸é‚»ç»“ç‚¹ä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚       | SLIPï¼ŒCSLIPï¼ŒPPPï¼ŒARPï¼ŒRARPï¼ŒMTU         |
| ç‰©ç†å±‚     | ä½¿åŸå§‹çš„æ•°æ®æ¯”ç‰¹æµèƒ½åœ¨ç‰©ç†åª’ä»‹ä¸Šä¼ è¾“ã€‚ | ISO2110ï¼ŒIEEE802ï¼ŒIEEE802.2              |



 å…¶å®æˆ‘ä»¬å†™ä»£ç æ˜¯æ²¡å¿…è¦å…³å¿ƒå…·ä½“çš„åº•å±‚å®ç°é€»è¾‘çš„ï¼Œç³»ç»Ÿå·²ç»ç»™æˆ‘ä»¬å¼€æ”¾äº†Socketçš„å¥—æ¥å­—ç¼–ç¨‹æ¥å£ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾ˆç®€å•çš„ç”¨Socketè¿›è¡Œå¼€å‘ï¼Œå½“ç„¶æˆ‘ä»¬ä»¥åå¯èƒ½ä¼šæ¥è§¦å¾ˆå¤šæœºé‡ï¼ŒHttpåè®®çš„åº”ç”¨å±‚çš„å¼€å‘ï¼Œå…¶å®å…¶åº•å±‚ä¹Ÿæ˜¯Socketã€‚

### 2ã€æ•°æ®æ˜¯æ€ä¹ˆä¼ è¾“çš„

#### ï¼ˆ1ï¼‰TCPåè®®

 *TCP(Transmission Control Protocol ä¼ è¾“æ§åˆ¶åè®®)*æ˜¯ä¸€ç§é¢å‘è¿æ¥(è¿æ¥å¯¼å‘)çš„ã€å¯é çš„ã€ åŸºäºIPçš„ä¼ è¾“å±‚åè®®ã€‚æä¾›äº†æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ã€è¶…æ—¶é‡ä¼ ç­‰æœºåˆ¶ã€‚

 TCPæ˜¯é¢å‘é“¾æ¥çš„ï¼Œå»ºç«‹é“¾æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¸‰æ¬¡æ¡æ‰‹æ˜¯ä¸ºäº†ä¿éšœåŒæ–¹éƒ½çŸ¥é“å¯¹æ–¹æœ‰å‘é€å’Œæ¥æ”¶æŠ¥æ–‡çš„èƒ½åŠ›ã€‚

![image-20210813164457689](./img/image-20210813164457689-41dbed69.png)

![image-20210813151258311](./img/image-20210813151258311-73856272.png)

æ–­å¼€é“¾æ¥æ˜¯éœ€è¦ä¸€ä¸ªå››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼š

![image-20210813151313108](./img/image-20210813151313108-773dac74.png)

#### ï¼ˆ2ï¼‰UDPåè®®

 UDP(User Datagram Protocolï¼Œç”¨æˆ·æ•°æ®æŠ¥åè®®)æ˜¯ä¸€ç§**ä¼ è¾“å±‚**çš„åè®®ï¼Œå®ƒæä¾›**ä¸å¯é **æœåŠ¡ï¼Œå®ƒæ˜¯æ— è¿æ¥çš„ï¼Œæ‰€ä»¥**ä¸å­˜åœ¨å»ºç«‹è¿æ¥éœ€è¦çš„æ—¶å»¶**ã€‚

 æœ‰äº›åœºæ™¯å¦‚ç›´æ’­ã€ç”µè¯ä¼šè®®ï¼Œ**èƒ½å®¹ä¸€äº›æ•°æ®çš„ä¸¢å¤±ï¼Œä½†æ˜¯ä¸èƒ½å…è®¸æœ‰è¾ƒå¤§çš„æ—¶å»¶**ã€‚

 TCPéœ€è¦åœ¨ç«¯ç³»ç»Ÿä¸­**ç»´æŠ¤è¿æ¥**çŠ¶æ€ï¼Œéœ€è¦ä¸€å®šçš„å¼€é”€ã€‚æ­¤è¿æ¥è£…å…¥åŒ…æ‹¬æ¥æ”¶å’Œå‘é€ç¼“å­˜ï¼Œæ‹¥å¡æ§åˆ¶å‚æ•°å’Œåºå·ä¸ç¡®è®¤å·çš„å‚æ•°ã€‚UCPä¸ç»´æŠ¤è¿æ¥çŠ¶æ€ï¼Œä¹Ÿä¸è·Ÿè¸ªè¿™äº›å‚æ•°ï¼Œå¼€é”€å°ã€‚ç©ºé—´å’Œæ—¶é—´ä¸Šéƒ½å…·æœ‰ä¼˜åŠ¿ã€‚UDP**æä¾›å°½æœ€å¤§åŠªåŠ›çš„äº¤ä»˜**ï¼Œä¸ä¿è¯å¯é äº¤ä»˜ã€‚

 UDPå¸¸ç”¨ä¸€æ¬¡æ€§ä¼ è¾“æ¯”è¾ƒå°‘é‡æ•°æ®çš„ç½‘ç»œåº”ç”¨ï¼Œå¦‚DNS,SNMPç­‰ï¼Œå› ä¸ºå¯¹äºè¿™äº›åº”ç”¨ï¼Œè‹¥æ˜¯é‡‡ç”¨TCPï¼Œä¸ºè¿æ¥çš„åˆ›å»ºï¼Œç»´æŠ¤å’Œæ‹†é™¤å¸¦æ¥ä¸å°çš„å¼€é”€ã€‚UDPä¹Ÿå¸¸ç”¨äºå¤šåª’ä½“åº”ç”¨ï¼ˆå¦‚IPç”µè¯ï¼Œå®æ—¶è§†é¢‘ä¼šè®®ï¼Œæµåª’ä½“ç­‰ï¼‰æ•°æ®çš„å¯é ä¼ è¾“å¯¹ä»–ä»¬è€Œè¨€å¹¶ä¸é‡è¦ï¼ŒTCPçš„æ‹¥å¡æ§åˆ¶ä¼šä½¿ä»–ä»¬æœ‰è¾ƒå¤§çš„å»¶è¿Ÿï¼Œä¹Ÿæ˜¯ä¸å¯å®¹å¿çš„

 ![image-20210914100950338](./img/image-20210914100950338-19cc56a7.png)

## ä¸‰ã€Socket ç¼–ç¨‹

 Socketç¼–ç¨‹æ˜¯åœ¨TCP/IPä¸Šçš„ç½‘ç»œç¼–ç¨‹ï¼Œä½†æ˜¯Socketåœ¨ä¸Šè¿°æ¨¡å‹çš„ä»€ä¹ˆä½ç½®å‘¢ã€‚è¿™ä¸ªä½ç½®è¢«ä¸€ä¸ªå¤©æ‰çš„ç†è®ºå®¶æˆ–è€…æ˜¯æŠ½è±¡çš„è®¡ç®—æœºå¤§ç¥æå‡ºå¹¶ä¸”å®‰æ’å‡ºæ¥

 æˆ‘ä»¬å¯ä»¥å‘ç°Socketå°±åœ¨åº”ç”¨ç¨‹åºçš„ä¼ è¾“å±‚å’Œåº”ç”¨å±‚ä¹‹é—´ï¼Œè®¾è®¡äº†ä¸€ä¸ªSocketæŠ½è±¡å±‚ï¼Œä¼ è¾“å±‚çš„åº•ä¸€å±‚çš„æœåŠ¡æä¾›ç»™SocketæŠ½è±¡å±‚ï¼ŒSocketæŠ½è±¡å±‚å†æä¾›ç»™åº”ç”¨å±‚ï¼Œé—®é¢˜åˆæ¥äº†ï¼Œåº”ç”¨å±‚å’ŒSocketæŠ½è±¡å±‚ä¹‹é—´å’Œä¼ è¾“å±‚ï¼Œç½‘ç»œå±‚ä¹‹é—´å¦‚ä½•é€šè®¯çš„å‘¢ï¼Œäº†è§£è¿™ä¸ªä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯å›åˆ°åŸç‚¹

 è¦æƒ³ç†è§£Socketç¼–ç¨‹æ€ä¹ˆé€šè¿‡Socketå…³é”®è¯å®ç°æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šè®¯ï¼Œå¿…é¡»å¾—å…ˆäº†è§£TCP/IPæ˜¯æ€ä¹ˆé€šè®¯çš„ï¼Œåœ¨è¿™ä¸ªçš„åŸºç¡€ä¸Šå†å»ç†è§£Socketçš„æ¡æ‰‹é€šè®¯

![image-20210914113006905](./img/image-20210914113006905-cf50ca47.png)

 å¥—æ¥å­—ä½¿ç”¨TCPæä¾›äº†ä¸¤å°è®¡ç®—æœºä¹‹é—´çš„é€šä¿¡æœºåˆ¶ã€‚ å®¢æˆ·ç«¯ç¨‹åºåˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œå¹¶å°è¯•è¿æ¥æœåŠ¡å™¨çš„å¥—æ¥å­—ã€‚

 å½“è¿æ¥å»ºç«‹æ—¶ï¼ŒæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ª Socket å¯¹è±¡ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç°åœ¨å¯ä»¥é€šè¿‡å¯¹ Socket å¯¹è±¡çš„å†™å…¥å’Œè¯»å–æ¥è¿›è¡Œé€šä¿¡ã€‚

java.net.Socket ç±»ä»£è¡¨ä¸€ä¸ªå¥—æ¥å­—ï¼Œå¹¶ä¸” java.net.ServerSocket ç±»ä¸ºæœåŠ¡å™¨ç¨‹åºæä¾›äº†ä¸€ç§æ¥ç›‘å¬å®¢æˆ·ç«¯ï¼Œå¹¶ä¸ä»–ä»¬å»ºç«‹è¿æ¥çš„æœºåˆ¶ã€‚

ä»¥ä¸‹æ­¥éª¤åœ¨ä¸¤å°è®¡ç®—æœºä¹‹é—´ä½¿ç”¨å¥—æ¥å­—å»ºç«‹TCPè¿æ¥æ—¶ä¼šå‡ºç°ï¼š

- æœåŠ¡å™¨å®ä¾‹åŒ–ä¸€ä¸ª ServerSocket å¯¹è±¡ï¼Œè¡¨ç¤ºé€šè¿‡æœåŠ¡å™¨ä¸Šçš„ç«¯å£é€šä¿¡ã€‚
- æœåŠ¡å™¨è°ƒç”¨ ServerSocket ç±»çš„ `accept()` æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šç»™å®šçš„ç«¯å£ã€‚
- æœåŠ¡å™¨æ­£åœ¨ç­‰å¾…æ—¶ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯å®ä¾‹åŒ–ä¸€ä¸ª Socket å¯¹è±¡ï¼ŒæŒ‡å®šæœåŠ¡å™¨åç§°å’Œç«¯å£å·æ¥è¯·æ±‚è¿æ¥ã€‚
- Socket ç±»çš„æ„é€ å‡½æ•°è¯•å›¾å°†å®¢æˆ·ç«¯è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡å™¨å’Œç«¯å£å·ã€‚å¦‚æœé€šä¿¡è¢«å»ºç«‹ï¼Œåˆ™åœ¨å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ª Socket å¯¹è±¡èƒ½å¤Ÿä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚
- åœ¨æœåŠ¡å™¨ç«¯ï¼Œ`accept()` æ–¹æ³•è¿”å›æœåŠ¡å™¨ä¸Šä¸€ä¸ªæ–°çš„ Socket å¼•ç”¨ï¼Œè¯¥ Socket è¿æ¥åˆ°å®¢æˆ·ç«¯çš„ Socketã€‚

![image-20210914114356892](./img/image-20210914114356892-58f88a8c.png)

åœ¨å­¦ä¹ Socketç¼–ç¨‹åæˆ‘ä»¬å…ˆå­¦ä¹ å‡ ä¸ªå·¥å…·ç±»ï¼š

### 1ã€InetAddress

```text
Internet Protocol (IP) address
```

#### ï¼ˆ1ï¼‰ä¸»æœºå

 è¿™ä¸ªç±»è¡¨ç¤ºäº’è”ç½‘åè®®(IP)åœ°å€ã€‚ä¸‹é¢åˆ—å‡ºäº† Socket ç¼–ç¨‹æ—¶æ¯”è¾ƒæœ‰ç”¨çš„æ–¹æ³•ï¼š

 ã€ä¸»æœºåã€‘å°±æ˜¯è®¡ç®—æœºçš„åå­—ï¼ˆè®¡ç®—æœºåï¼‰ï¼Œè¿™ä¸ªåå­—å¯ä»¥éšæ—¶æ›´æ”¹ï¼Œä»æˆ‘çš„ç”µè„‘-å±æ€§çš„è®¡ç®—æœºåå°±å¯æ›´æ”¹ã€‚

![image-20210914101034815](./img/image-20210914101034815-946342dc.png)



> ä¸»æœºåå’ŒåŸŸåçš„è”ç³»ä¸åŒºåˆ«å¦‚ä¸‹ï¼š

1ã€InternetåŸŸåæ˜¯Internetç½‘ç»œä¸Šçš„ä¸€ä¸ªæœåŠ¡å™¨æˆ–ä¸€ä¸ªç½‘ç»œç³»ç»Ÿçš„åå­—,åœ¨å…¨ä¸–ç•Œ,æ²¡æœ‰é‡å¤çš„åŸŸåã€‚åŸŸåçš„èŒƒå›´è¦æ¯”ä¸»æœºåå¤§ã€‚ä¸€ä¸ªåŸŸåä¸‹å¯ä»¥æœ‰å¤šä¸ªä¸»æœºå,åŸŸåä¸‹è¿˜å¯ä»¥æœ‰å­åŸŸåã€‚ä¾‹å¦‚,åŸŸåcnwg\.cnä¸‹,æœ‰ä¸»æœºserver1å’Œserver2,å…¶ä¸»æœºå…¨åå°±æ˜¯server1\.cnwg\.cn å’Œ server2\.cnwg\.cn

2ã€ä¸»æœºåçš„å«ä¹‰æ˜¯æœºå™¨æœ¬èº«çš„åå­—ï¼ŒåŸŸåæ˜¯æ–¹é¢è®°å½•IPåœ°å€æ‰åšçš„ä¸€ç§IPæ˜ å°„ï¼›äºŒè€…æœ‰å…±æ€§ï¼šéƒ½èƒ½å¯¹åº”åˆ°ä¸€ä¸ªå”¯ä¸€çš„IPä¸Šï¼Œä»åº”ç”¨åœºæ™¯ä¸Šå¯ä»¥è¿™ä¹ˆç®€å•ç†è§£äºŒè€…çš„åŒºåˆ«ï¼šä¸»æœºåç”¨äºå±€åŸŸç½‘ä¸­ï¼›åŸŸåç”¨äºå…¬ç½‘ä¸­ã€‚

#### ï¼ˆ2ï¼‰ç¯å›åœ°å€

 ç¯å›åœ°å€æ˜¯ä¸»æœºç”¨äºå‘è‡ªèº«å‘é€é€šä¿¡çš„ä¸€ä¸ªç‰¹æ®Šåœ°å€ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç›®çš„åœ°å€ï¼‰ã€‚è®¿é—®æœ¬æœºçš„ç¯å›åœ°å€å¯ä»¥ç»•å¼€TCP/IPåè®®æ ˆçš„ä¸‹å±‚ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼šä¸ç”¨å†é€šè¿‡ä»€ä¹ˆé“¾è·¯å±‚ã€ç‰©ç†å±‚ã€ä»¥å¤ªç½‘ä¼ å‡ºå»äº†ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥åœ¨è‡ªå·±çš„ç½‘ç»œå±‚ã€è¿è¾“å±‚è¿›è¡Œå¤„ç†äº†ï¼‰

 IPv4çš„ç¯å›åœ°å€ä¸ºï¼š127.0.0.0åˆ°127.255.255.255éƒ½æ˜¯ç¯å›åœ°å€ï¼ˆåªæ˜¯æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„ä¿ç•™ï¼‰ï¼Œæ­¤åœ°å€ä¸­çš„ä»»ä½•åœ°å€éƒ½ä¸ä¼šå‡ºç°åœ¨ç½‘ç»œä¸­ï¼Œç½‘ç»œå·ä¸º127çš„åœ°å€æ ¹æœ¬å°±ä¸æ˜¯ä¸€ä¸ªç½‘ç»œåœ°å€ï¼ˆå› ä¸ºäº§ç”Ÿçš„IPæ•°æ®æŠ¥å°±ä¸ä¼šåˆ°è¾¾å¤–éƒ¨ç½‘ç»œæ¥å£ä¸­ï¼Œæ˜¯ä¸ç¦»å¼€ä¸»æœºçš„åŒ…ï¼‰

 å½“æ“ä½œç³»ç»Ÿåˆå§‹åŒ–æœ¬æœºçš„TCP/IPåè®®æ ˆæ—¶ï¼Œè®¾ç½®åè®®æ ˆæœ¬èº«çš„IPåœ°å€ä¸º127.0.0.1ï¼ˆä¿ç•™åœ°å€ï¼‰ã€‚å½“IPå±‚æ¥æ”¶åˆ°ç›®çš„åœ°å€ä¸º127.0.0.1ï¼ˆå‡†ç¡®çš„è¯´æ˜¯ï¼šç½‘ç»œå·ä¸º127çš„IPï¼‰çš„æ•°æ®åŒ…æ—¶ï¼Œä¸è°ƒç”¨ç½‘å¡é©±åŠ¨è¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œè€Œæ˜¯ç«‹å³è½¬å‘åˆ°æœ¬æœºIPå±‚è¿›è¡Œå¤„ç†ï¼Œç”±äºä¸æ¶‰åŠåº•å±‚æ“ä½œã€‚å› æ­¤ï¼Œping 127.0.0.1ä¸€èˆ¬ä½œä¸ºæµ‹è¯•æœ¬æœºTCP/IPåè®®æ ˆæ­£å¸¸ä¸å¦çš„åˆ¤æ–­ä¹‹ä¸€ã€‚

 æ‰€ä»¥è¯´ï¼š127.0.0.1æ˜¯ä¿ç•™åœ°å€ä¹‹ä¸€ï¼Œåªæ˜¯è¢«ç»å¸¸çš„ä½¿ç”¨ï¼Œæ¥æ£€éªŒæœ¬æœºTCP/IPåè®®æ ˆè€Œå·²ã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥pingé€šçš„è¯ï¼Œå°±è¯´æ˜ï¼šæœ¬æœºçš„ç½‘å¡å’ŒIPåè®®å®‰è£…éƒ½æ²¡æœ‰é—®é¢˜ã€‚ï¼ˆè·Ÿæˆ‘ä»¬å½“å‰ä¸»æœºæœ‰æ²¡æœ‰è”ç½‘æ²¡æœ‰ä¸€ç‚¹å…³ç³»ï¼‰

#### ï¼ˆ3ï¼‰localhost

localhostæ˜¯ä¸ªåŸŸåï¼Œä½†æ˜¯æ˜¯ä¸ªä¿ç•™åŸŸåï¼Œæ˜¯ç»™å›è·¯ç½‘ç»œæ¥å£ï¼ˆloopbackï¼‰çš„ä¸€ä¸ªæ ‡å‡†ä¸»æœºåï¼Œç›¸å¯¹åº”çš„IPåœ°å€ä¸º127.0.0.1ï¼ˆIPv4ï¼‰å’Œ[::1]ï¼ˆIPv6ï¼‰ã€‚å®ƒå¯ä»¥è¢«é…ç½®ä¸ºä»»æ„çš„IPåœ°å€ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥é€šè¿‡hostsè¿™ä¸ªæ–‡ä»¶è¿›è¡Œæ›´æ”¹çš„ï¼‰ï¼Œä¸è¿‡é»˜è®¤æƒ…å†µä¸‹éƒ½æŒ‡å‘ï¼š 127.0.0.1ã€‚

 æœ¬æœºIPï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæœ¬æœºæœ‰ä¸‰å—ç½‘å¡ï¼Œä¸€å—ç½‘å¡å«åšloopbackï¼ˆè™šæ‹Ÿç½‘å¡ï¼‰ï¼Œä¸€å—å«åšethernetï¼ˆæœ‰çº¿ç½‘å¡ï¼‰ï¼Œä¸€å—å«åšwlanï¼ˆä½ çš„æ— çº¿ç½‘å¡ï¼‰ã€‚

#### ï¼ˆ4ï¼‰InetAddressçš„ä½¿ç”¨

| **åºå·** | **æ–¹æ³•æè¿°**                                              |                                                     |
| -------- | --------------------------------------------------------- | --------------------------------------------------- |
| 1        | static InetAddress getByAddress(byte[] addr)              | åœ¨ç»™å®šåŸå§‹ IP åœ°å€çš„æƒ…å†µä¸‹ï¼Œè¿”å› InetAddress å¯¹è±¡ã€‚ |
| 2        | static InetAddress getByAddress(String host, byte[] addr) | æ ¹æ®æä¾›çš„ä¸»æœºåå’Œ IP åœ°å€åˆ›å»º InetAddressã€‚        |
| 3        | static InetAddress getByName(String host)                 | åœ¨ç»™å®šä¸»æœºåçš„æƒ…å†µä¸‹ç¡®å®šä¸»æœºçš„ IP åœ°å€ã€‚            |
| 4        | String getHostAddress()                                   | è¿”å› IP åœ°å€å­—ç¬¦ä¸²ï¼ˆä»¥æ–‡æœ¬è¡¨ç°å½¢å¼ï¼‰ã€‚              |
| 5        | String getHostName()                                      | è·å–æ­¤ IP åœ°å€çš„ä¸»æœºåã€‚                            |
| 6        | static InetAddress getLocalHost()                         | è¿”å›æœ¬åœ°ä¸»æœºã€‚                                      |
| 7        | String toString()                                         | å°†æ­¤ IP åœ°å€è½¬æ¢ä¸º Stringã€‚                         |

------

æˆ‘ä»¬å¯ä»¥å†™ä¸ªä»£ç æ‰¾åˆ°ç™¾åº¦çš„IPï¼š

```java
InetAddress inetAddress = InetAddress.getByName("www.baidu.com");
System.out.println(inetAddress.getHostAddress());
```

### 2ã€URL

#### ï¼ˆ1ï¼‰ç®€ä»‹

 URLï¼ˆUniform Resource Locatorï¼‰ä¸­æ–‡åä¸ºç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œå’±ä»¬çš„ç½‘é¡µåœ°å€ä¹Ÿæ˜¯ä¸€ç§URLã€‚è¡¨ç¤ºä¸ºäº’è”ç½‘ä¸Šçš„èµ„æºï¼Œå¦‚ç½‘é¡µæˆ–è€… FTP åœ°å€ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨URLå¾ˆæ–¹ä¾¿çš„å®šä½åˆ°ä¸€ä¸ªèµ„æºï¼ŒURL å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ã€‚

```text
protocol://host:port/path?query#fragment
```

protocol(åè®®)å¯ä»¥æ˜¯ HTTPã€HTTPSã€FTP å’Œ Fileï¼Œport ä¸ºç«¯å£å·ï¼Œpathä¸ºæ–‡ä»¶è·¯å¾„åŠæ–‡ä»¶åã€‚

è¿™ä¸ªä¸€ä¸ªQQçš„ä¸‹è½½URLï¼š

```
https://down.qq.com/qqweb/PCQQ/PCQQ_EXE/PCQQ2021.exe
```

URL è§£æï¼š

- åè®®ä¸º(protocol)ï¼šhttps
- ä¸»æœºä¸º(host:port)ï¼šdown\.qq\.com
- ç«¯å£å·ä¸º(port) 443 ï¼Œä»¥ä¸ŠURLå®ä¾‹å¹¶æœªæŒ‡å®šç«¯å£ï¼Œå› ä¸º HTTPS åè®®é»˜è®¤çš„ç«¯å£å·ä¸º443ã€‚HTTPä¸º80ã€‚
- æ–‡ä»¶è·¯å¾„ä¸º(path)ï¼š/qqweb/PCQQ/PCQQ_EXE/PCQQ2021\.exe

å½“ç„¶æœ¬åœ°æ–‡ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨URLæ¥è¡¨ç¤ºï¼š

```java
file:///D:/a.txt
```

#### ï¼ˆ2ï¼‰URL ç±»æ–¹æ³•

 åœ¨java.netåŒ…ä¸­å®šä¹‰äº†URLç±»ï¼Œè¯¥ç±»ç”¨æ¥å¤„ç†æœ‰å…³URLçš„å†…å®¹ã€‚å¯¹äºURLç±»çš„åˆ›å»ºå’Œä½¿ç”¨ï¼Œä¸‹é¢åˆ†åˆ«è¿›è¡Œä»‹ç»ã€‚

 java.net.URLæä¾›äº†ä¸°å¯Œçš„URLæ„å»ºæ–¹å¼ï¼Œå¹¶å¯ä»¥é€šè¿‡java.net.URLæ¥è·å–èµ„æºã€‚

| åºå· | æ–¹æ³•æè¿°                                                     |                                                              |
| :--- | :----------------------------------------------------------- | ------------------------------------------------------------ |
| 1    | public URL(String protocol, String host, int port, String file) throws MalformedURLException | é€šè¿‡ç»™å®šçš„å‚æ•°(åè®®ã€ä¸»æœºåã€ç«¯å£å·ã€æ–‡ä»¶å)åˆ›å»ºURLã€‚        |
| 2    | public URL(String protocol, String host, String file) throws MalformedURLException | ä½¿ç”¨æŒ‡å®šçš„åè®®ã€ä¸»æœºåã€æ–‡ä»¶ååˆ›å»ºURLï¼Œç«¯å£ä½¿ç”¨åè®®çš„é»˜è®¤ç«¯å£ã€‚ |
| 3    | public URL(String url) throws MalformedURLException          | é€šè¿‡ç»™å®šçš„URLå­—ç¬¦ä¸²åˆ›å»ºURL                                   |
| 4    | public URL(URL context, String url) throws MalformedURLException | ä½¿ç”¨åŸºåœ°å€å’Œç›¸å¯¹URLåˆ›å»º                                      |

 URLç±»ä¸­åŒ…å«äº†å¾ˆå¤šæ–¹æ³•ç”¨äºè®¿é—®URLçš„å„ä¸ªéƒ¨åˆ†ï¼Œå…·ä½“æ–¹æ³•åŠæè¿°å¦‚ä¸‹ï¼š

| åºå· | æ–¹æ³•                                                     | æè¿°                                    |
| :--- | :------------------------------------------------------- | --------------------------------------- |
| 1    | public String getPath()                                  | è¿”å›URLè·¯å¾„éƒ¨åˆ†ã€‚                       |
| 4    | public int getPort()                                     | è¿”å›URLç«¯å£éƒ¨åˆ†                         |
| 5    | public int getDefaultPort()                              | è¿”å›åè®®çš„é»˜è®¤ç«¯å£å·ã€‚                  |
| 6    | public String getProtocol()                              | è¿”å›URLçš„åè®®                           |
| 7    | public String getHost()                                  | è¿”å›URLçš„ä¸»æœº                           |
| 8    | public String getFile()                                  | è¿”å›URLæ–‡ä»¶åéƒ¨åˆ†                       |
| 10   | public URLConnection openConnection() throws IOException | æ‰“å¼€ä¸€ä¸ªURLè¿æ¥ï¼Œå¹¶è¿è¡Œå®¢æˆ·ç«¯è®¿é—®èµ„æºã€‚ |

æ¯”å¦‚æˆ‘ä»¬æƒ³è®¿é—®æ–‡ä»¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ï¼š

```java
public static void main(String[] args) throws IOException {
    URL resource = new URL("file:///D:/a.txt");
    URLConnection urlConnection = resource.openConnection();
    InputStream inputStream = urlConnection.getInputStream();

    byte[] buf = new byte[1024];
    int len;
    while ((len = inputStream.read(buf)) != -1){
        System.out.println(new String(buf,0,len));
    }
}
```

 å¦‚æœæˆ‘ä»¬æŠŠurlæ¢æˆQQçš„æ–‡ä»¶ä¸‹è½½åœ°å€ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨javaä»£ç ä¸‹è½½ç½‘ç»œæ–‡ä»¶äº†ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```java
public static void main(String[] args) throws IOException {
    URL url = new URL("https://down.qq.com/qqweb/PCQQ/PCQQ_EXE/PCQQ2021.exe");
    URLConnection urlConnection = url.openConnection();
    InputStream inputStream = urlConnection.getInputStream();
    OutputStream outputStream = new FileOutputStream("D:/QQ.exe");
    byte[] bytes = new byte[1024];
    int len;
    while ((len = inputStream.read(bytes)) != -1){
        outputStream.write(bytes,0,len);
    }
}
```

### 3ã€ServerSocket ç±»çš„æ–¹æ³•

 æœåŠ¡å™¨åº”ç”¨ç¨‹åºé€šè¿‡ä½¿ç”¨ java.net.ServerSocket ç±»ä»¥è·å–ä¸€ä¸ªç«¯å£,å¹¶ä¸”ä¾¦å¬å®¢æˆ·ç«¯è¯·æ±‚ã€‚

 ServerSocket ç±»æœ‰å››ä¸ªæ„é€ æ–¹æ³•ï¼š

 backlogæ˜¯ä¸€ä¸ªé˜Ÿåˆ—é•¿åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„æŠŠä»–ç†è§£ä¸ºæœ€å¤šå…è®¸å¤šå°‘ä¸ªäººæ’é˜Ÿæ¡æ‰‹ã€‚

| **åºå·** | **æ–¹æ³•æè¿°**                                                 |                                                              |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1        | public ServerSocket(int port)                                | åˆ›å»ºç»‘å®šåˆ°ç‰¹å®šç«¯å£çš„æœåŠ¡å™¨å¥—æ¥å­—                             |
| 2        | public ServerSocket(int port, int backlog)                   | åˆ©ç”¨æŒ‡å®šçš„ backlog åˆ›å»ºæœåŠ¡å™¨å¥—æ¥å­—å¹¶å°†å…¶ç»‘å®šåˆ°æŒ‡å®šçš„æœ¬åœ°ç«¯å£å· |
| 3        | public ServerSocket(int port, int backlog, InetAddress address) | ä½¿ç”¨æŒ‡å®šçš„ç«¯å£ã€ä¾¦å¬ backlog å’Œè¦ç»‘å®šåˆ°çš„æœ¬åœ° IP åœ°å€åˆ›å»ºæœåŠ¡å™¨ |
| 4        | public ServerSocket() throws IOException                     | åˆ›å»ºéç»‘å®šæœåŠ¡å™¨å¥—æ¥å­—                                       |

 åˆ›å»ºéç»‘å®šæœåŠ¡å™¨å¥—æ¥å­—ã€‚ å¦‚æœ ServerSocket æ„é€ æ–¹æ³•æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œå°±æ„å‘³ç€ä½ çš„åº”ç”¨ç¨‹åºå·²ç»æˆåŠŸç»‘å®šåˆ°æŒ‡å®šçš„ç«¯å£ï¼Œå¹¶ä¸”ä¾¦å¬å®¢æˆ·ç«¯è¯·æ±‚ã€‚

è¿™é‡Œæœ‰ä¸€äº› ServerSocket ç±»çš„å¸¸ç”¨æ–¹æ³•ï¼š

| **åºå·** | **æ–¹æ³•æè¿°**                                                 |
| -------- | ------------------------------------------------------------ |
| 1        | public int getLocalPort() è¿”å›æ­¤å¥—æ¥å­—åœ¨å…¶ä¸Šä¾¦å¬çš„ç«¯å£ã€‚     |
| 2        | public Socket accept() ä¾¦å¬å¹¶æ¥å—åˆ°æ­¤å¥—æ¥å­—çš„è¿æ¥ã€‚          |
| 4        | public void bind(SocketAddress host, int backlog) å°† ServerSocket ç»‘å®šåˆ°ç‰¹å®šåœ°å€ï¼ˆIP åœ°å€å’Œç«¯å£å·ï¼‰ã€‚ |

------



 SocketAddress æŒ‡ä¸€ä¸ªSocketçš„åœ°å€ï¼Œå®ƒå’ŒInetAddress ä¸åŒï¼ŒSocketç½‘ç»œåœ°å€é™¤äº†éœ€è¦ä¸»æœºåæˆ–IPä¹‹å¤–ï¼Œè¿˜éœ€è¦ä¸€ä¸ªç”¨äºé€šä¿¡çš„ç«¯å£ï¼š

æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°å®ƒçš„ä¸€ä¸ªå­ç±»ï¼šInetSocketAddressçš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š

```java
public InetSocketAddress(int port) {
    this(InetAddress.anyLocalAddress(), port);
}

public synchronized InetAddress anyLocalAddress() {
    if (anyLocalAddress == null) {
        anyLocalAddress = new Inet4Address(); // {0x00,0x00,0x00,0x00}
        anyLocalAddress.holder().hostName = "0.0.0.0";
    }
    return anyLocalAddress;
}

-----------------------------------------------------------

public InetSocketAddress(InetAddress addr, int port) {
    holder = new InetSocketAddressHolder(
        null,
        addr == null ? InetAddress.anyLocalAddress() : addr,
        checkPort(port));
}
```

### 4ã€Socket ç±»çš„æ–¹æ³•

java.net.Socket ç±»ä»£è¡¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½ç”¨æ¥äº’ç›¸æ²Ÿé€šçš„å¥—æ¥å­—ã€‚å®¢æˆ·ç«¯è¦è·å–ä¸€ä¸ª Socket å¯¹è±¡é€šè¿‡å®ä¾‹åŒ– ï¼Œè€Œ æœåŠ¡å™¨è·å¾—ä¸€ä¸ª Socket å¯¹è±¡åˆ™é€šè¿‡ `accept()` æ–¹æ³•çš„è¿”å›å€¼ã€‚

Socket ç±»æœ‰äº”ä¸ªæ„é€ æ–¹æ³•.

| **åºå·** | **æ–¹æ³•æè¿°**                                                 |
| -------- | ------------------------------------------------------------ |
| 1        | public Socket(String host, int port) throws UnknownHostException, IOException. åˆ›å»ºä¸€ä¸ªæµå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®šä¸»æœºä¸Šçš„æŒ‡å®šç«¯å£å·ã€‚ |
| 2        | public Socket(InetAddress host, int port) throws IOException åˆ›å»ºä¸€ä¸ªæµå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®š IP åœ°å€çš„æŒ‡å®šç«¯å£å·ã€‚ |
| 3        | public Socket(String host, int port, InetAddress localAddress, int localPort) throws IOException. åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®šè¿œç¨‹ä¸»æœºä¸Šçš„æŒ‡å®šè¿œç¨‹ç«¯å£ã€‚ |
| 4        | public Socket(InetAddress host, int port, InetAddress localAddress, int localPort) throws IOException. åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®šè¿œç¨‹åœ°å€ä¸Šçš„æŒ‡å®šè¿œç¨‹ç«¯å£ã€‚ |
| 5        | public Socket() é€šè¿‡ç³»ç»Ÿé»˜è®¤ç±»å‹çš„ SocketImpl åˆ›å»ºæœªè¿æ¥å¥—æ¥å­— |

å½“ Socket æ„é€ æ–¹æ³•è¿”å›ï¼Œå¹¶æ²¡æœ‰ç®€å•çš„å®ä¾‹åŒ–äº†ä¸€ä¸ª Socket å¯¹è±¡ï¼Œå®ƒå®é™…ä¸Šä¼šå°è¯•è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡å™¨å’Œç«¯å£ã€‚

ä¸‹é¢åˆ—å‡ºäº†ä¸€äº›æ„Ÿå…´è¶£çš„æ–¹æ³•ï¼Œæ³¨æ„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½æœ‰ä¸€ä¸ª Socket å¯¹è±¡ï¼Œæ‰€ä»¥æ— è®ºå®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯éƒ½èƒ½å¤Ÿè°ƒç”¨è¿™äº›æ–¹æ³•ã€‚

| **åºå·** | **æ–¹æ³•æè¿°**                                                 |
| -------- | ------------------------------------------------------------ |
| 1        | **public void connect(SocketAddress host, int timeout) throws IOException** å°†æ­¤å¥—æ¥å­—è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªè¶…æ—¶å€¼ã€‚ |
| 2        | **public InetAddress getInetAddress()** è¿”å›å¥—æ¥å­—è¿æ¥çš„åœ°å€ã€‚ |
| 3        | **public int getPort()** è¿”å›æ­¤å¥—æ¥å­—è¿æ¥åˆ°çš„è¿œç¨‹ç«¯å£ã€‚      |
| 4        | **public int getLocalPort()** è¿”å›æ­¤å¥—æ¥å­—ç»‘å®šåˆ°çš„æœ¬åœ°ç«¯å£ã€‚ |
| 5        | **public SocketAddress getRemoteSocketAddress()** è¿”å›æ­¤å¥—æ¥å­—è¿æ¥çš„ç«¯ç‚¹çš„åœ°å€ï¼Œå¦‚æœæœªè¿æ¥åˆ™è¿”å› nullã€‚ |
| 6        | **public InputStream getInputStream() throws IOException** è¿”å›æ­¤å¥—æ¥å­—çš„è¾“å…¥æµã€‚ |
| 7        | **public OutputStream getOutputStream() throws IOException** è¿”å›æ­¤å¥—æ¥å­—çš„è¾“å‡ºæµã€‚ |
| 8        | **public void close() throws IOException** å…³é—­æ­¤å¥—æ¥å­—ã€‚    |

### 5ã€å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„é€šä¿¡

```java
@Test
public void serverTest() throws IOException {
    // åˆ›å»ºServerSocket
    ServerSocket server = new ServerSocket();
    // ç»‘å®šåœ¨æŸä¸€ä¸ªç«¯å£ä¸Š
    server.bind(new InetSocketAddress(8888));
    // ç›‘å¬åœ¨è¿™ä¸ªç«¯å£
    Socket socket = server.accept();

    InputStream inputStream = socket.getInputStream();

    byte[] buffer = new byte[1024 * 1024];
    int len;
    while ((len = inputStream.read(buffer)) != -1){
        System.out.println(new String(buffer,0,len));
    }
    inputStream.close();
    socket.close();
}

@Test
public void clientTest() throws IOException {
    // åˆ›å»ºSocket
    Socket socket = new Socket();
    // ä½¿ç”¨è¿™ä¸ªsocketè¿›è¡Œè¿æ¥
    socket.connect(new InetSocketAddress(InetAddress.getLoopbackAddress(),8888));

    InputStream inputStream = socket.getInputStream();
    OutputStream outputStream = socket.getOutputStream();
    outputStream.write("hello server!".getBytes());

    outputStream.close();
    inputStream.close();
    socket.close();

}
```

### 6ã€UDPçš„å®ç°

å¯¹äºUDPè€Œè¨€ï¼Œå®ƒæ˜¯æ²¡æœ‰è¿æ¥è¿‡ç¨‹çš„ï¼Œç›´æ¥é¢å‘çš„æ˜¯æ•°æ®æŠ¥ï¼Œæ‰€ä»¥ï¼Œåœ¨UDPä¸­åªæœ‰ä¸¤ä¸ªæ ¸å¿ƒçš„ç±»ã€‚

DatagramSocketï¼šç”¨æ¥å»ºç«‹socket

DatagramPacketï¼šç”¨æ¥å°è£…ä¸€ä¸ªæ•°æ®æŠ¥æ–‡

```java
public class UDPTest {

    //å‘é€ç«¯
    @Test
    public void sender() throws IOException {

        // åˆ›å»ºsocketï¼Œå¯ä»¥æŒ‡å®šç«¯å£ï¼Œå¦‚æœä¸æŒ‡å®šä¼šéšæœºå¼€ä¸€ä¸ªç«¯å£ï¼Œä¸€èˆ¬æˆ‘ä»¬å®¢æˆ·ç«¯éƒ½ä¼šé€‰æ‹©éšæœºç«¯å£
        DatagramSocket socket = new DatagramSocket();

        String str = "æˆ‘æ˜¯UDPæ–¹å¼å‘é€çš„å¯¼å¼¹";
        byte[] data = str.getBytes();
        // æ„å»ºä¸€ä¸ªæ•°æ®æŠ¥
        DatagramPacket packet = new DatagramPacket(
                    data.getBytes(),0,data.getBytes().length,
                    new InetSocketAddress(InetAddress.getByName("localhost"),8080)
            );

        // ç›´æ¥å‘é€
        socket.send(packet);

        socket.close();

    }
    //æ¥æ”¶ç«¯
    @Test
    @SuppressWarnings("InfiniteLoopStatement")
    public void receiver() throws IOException {

        DatagramSocket socket = new DatagramSocket(9090);

        byte[] buffer = new byte[100];
        DatagramPacket packet = new DatagramPacket(buffer,0,buffer.length);

        // æ¥æ”¶
        socket.receive(packet);
		// packet.getData() ç”¨æ¥è·å–æ•°æ®æŠ¥çš„æ•°æ®
        // packet.getLength() ç”¨æ¥è·å–è¯»å–çš„æ•°æ®æŠ¥çš„é•¿åº¦
        String str = new String(packet.getData(), 0, packet.getLength());
        System.out.println(str);

        socket.close();
    }
}
```

## å››ã€æ‰“é€ ä¸€ä¸ªèŠå¤©ç³»ç»Ÿ

> 1ã€åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯
>
> 2ã€åˆ›å»ºä¸€ä¸ªæœåŠ¡ç«¯

### 1.é¡¹ç›®æ„å»º

ï¼ˆ1ï¼‰å…ˆåœ¨ideaé‡Œé¢æ–°å»ºä¸€ä¸ªæ¨¡å— `stazxrChatServer`

 ![image-20231003225535445](./img/image-20231003225535445.png)

ï¼ˆ2ï¼‰å»ºåŒ…ï¼ŒåŒ…é‡Œé¢åˆ›å»º`cn.stazxr.Server`ç±»å’Œ`cn.stazxr.Client`ç±»

*Client*

```java
package cn.stazxr;

/**
 * åŠŸèƒ½ï¼š1ã€ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯  2ã€ç»™å¥½å‹å‘æ¶ˆæ¯  3ã€ç¾¤å‘æ¶ˆæ¯
 * 1ã€ç”¨ä»€ä¹ˆç±»å‹å‘æ¶ˆæ¯ï¼Ÿ
 */
public class Client {

    public static void main(String[] args) throws IOException {

    }

}
```

*Server*

```java
package cn.stazxr;

public class Server {

    public static void main(String[] args) throws IOException, ClassNotFoundException {

        }
    }
}
```

ï¼ˆ3ï¼‰å¯¹äºæˆ‘ä»¬çš„æœåŠ¡ç«¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨`ServerSocket`åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¹¶ç»‘å®šä¸€ä¸ªç«¯å£ã€‚

```java
public class Server {

    /*æœ‰å¼‚å¸¸å…ˆæŠ›å‡ºå»ï¼Œä¹‹åå†å¤„ç†*/
    public static void main(String[] args) throws IOException{
        // åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨
        ServerSocket serverSocket = new ServerSocket();
        // ç»‘å®šç«¯å£
        serverSocket.bind(new InetSocketAddress(8888));
        System.out.println("æœåŠ¡å™¨å·²ç»å¯åŠ¨ï¼Œåœ¨8888ç«¯å£ï¼");
    }
}
```

ï¼ˆ4ï¼‰å¯¹äºæˆ‘ä»¬çš„å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨`Socket`ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥ã€‚

```java
/**
 * åŠŸèƒ½ï¼š1ã€ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯  2ã€ç»™å¥½å‹å‘æ¶ˆæ¯  3ã€ç¾¤å‘æ¶ˆæ¯
 * 1ã€ç”¨ä»€ä¹ˆç±»å‹å‘æ¶ˆæ¯
 */
public class Client {
	/*æœ‰å¼‚å¸¸å…ˆæŠ›å‡ºå»ï¼Œä¹‹åå†å¤„ç†*/
    public static void main(String[] args) throws IOException {
        Socket socket = new Socket();
        // é“¾æ¥æœåŠ¡å™¨
        socket.connect(new InetSocketAddress(8888));
    }

}
```

ç°åœ¨ï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯æœ‰3ç§éœ€æ±‚

1. ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯
2. ç»™å¥½å‹å‘æ¶ˆæ¯
3. ç¾¤å‘æ¶ˆæ¯

æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹æ¶ˆæ¯è¿›è¡Œé€‰æ‹©ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨å‘æ¶ˆæ¯çš„æ—¶å€™ä½¿ç”¨ç‰¹å®šçš„å­—ç¬¦ä¸²æ ¼å¼ï¼š

```java
// å‘æ¶ˆæ¯
OutputStream outputStream = socket.getOutputStream();
// ä½¿ç”¨â€˜-â€™åˆ†å‰²å­—ç¬¦ä¸²
outputStream.write("type-Message".getBytes());
```

è¿™æ ·æˆ‘ä»¬åœ¨æœåŠ¡ç«¯å¤„ç†æ—¶ï¼Œå°±å¯ä»¥åˆ†è¾¨æœåŠ¡ç«¯æ¥å—åˆ°æ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®ã€‚ç„¶åï¼Œå†è¿›è¡Œå¯¹åº”çš„æ“ä½œã€‚

ä½†æ˜¯åœ¨javaæµä¸­ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªåºåˆ—åŒ–çš„æ“ä½œã€‚

æˆ‘ä»¬çš„å¯¹è±¡å¯ä»¥åºåˆ—åŒ–ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“ï¼

ï¼ˆ5ï¼‰åˆ›å»ºç±»Messageï¼Œæä¾›æ¶ˆæ¯çš„åºåˆ—åŒ–æ“ä½œ

```java
package cn.stazxr;

import java.io.Serial;
import java.io.Serializable;

public class Message implements Serializable {

    @Serial // serialVersionUID ä¸ºäº†ä»Šåçš„çš„ä¿®æ”¹ï¼Œå…ˆåŠ ä¸Š
    private static final long serialVersionUID = 8327856103560598769L;
    // æ¶ˆæ¯çš„ç±»å‹
    private Integer type;
    // æ¶ˆæ¯çš„å†…å®¹
    private String content;

    public Message() {
    }

    public Message(Integer type, String content) {
        this.type = type;
        this.content = content;
    }

    public Integer getType() {
        return type;
    }

    public void setType(Integer type) {
        this.type = type;
    }

    public String getContent() {
        return content;
    }

    public void setContent(String content) {
        this.content = content;
    }

    @Override
    public String toString() {
        return "Message{" +
                "type=" + type +
                ", content='" + content + '\'' +
                '}';
    }
}
```

æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Messageå¯¹è±¡æ¥ä¼ é€’æ¶ˆæ¯

```java
/**
 * åŠŸèƒ½ï¼š1ã€ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯  2ã€ç»™å¥½å‹å‘æ¶ˆæ¯  3ã€ç¾¤å‘æ¶ˆæ¯
 * 1ã€ç”¨ä»€ä¹ˆç±»å‹å‘æ¶ˆæ¯
 */
public class Client {

    public static void main(String[] args) throws IOException {
        Socket socket = new Socket();
        // é“¾æ¥æœåŠ¡å™¨
        socket.connect(new InetSocketAddress(8888));
        // å‘æ¶ˆæ¯
        OutputStream outputStream = socket.getOutputStream();
		outputStream.write(new Message(1,"hello"));
		// å…³é—­è¾“å‡ºæµ
        outputStream.close();
    }

}
```

ç¬¬13è¡Œä»£ç `outputStream.write(new Message(1,"hello"));`ï¼Œæˆ‘ä»¬ä¼ äº†ä¸€ä¸ªæ•°å­—1ï¼Œæ¥è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç»™æœåŠ¡å™¨å‘æ¶ˆæ¯çš„æ¶ˆæ¯ç±»å‹ã€‚

ä½†æ˜¯ç›´æ¥åœ¨å®¢æˆ·ç«¯ç¨‹åºå†™æ•°å­—ä¸æ˜¯å¾ˆç›´è§‚ï¼ˆä¸å¤Ÿé¢å‘å¯¹è±¡ï¼QAQï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¸¸é‡æˆ–æšä¸¾æ¥è¡¨ç¤º

è¿™é‡Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªMessageTypeç±»(cn\.stazxr\.constant\.MessageType)ï¼Œé‡‡ç”¨å¸¸é‡æ¥è¡¨ç¤ºæ¶ˆæ¯ç±»å‹ï¼š

```java
package cn.stazxr.constant;

public class MessageType {
    // ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯
    public static final int TO_SERVER = 1;
    // ç»™å¥½å‹å‘æ¶ˆæ¯
    public static final int TO_FRIEND = 2;
    // ç¾¤å‘æ¶ˆæ¯
    public static final int TO_ALL = 3;
}
```

`outputStream.write(new Message(1,"hello"));`å°±å¯ä»¥æ”¹æˆï¼š

`outputStream.write(new Message(MessageType.TO_SERVER,"hello"));`

è¿™æ ·æˆ‘ä»¬ä»¥åçš„ä»£ç å°±ä¼šåŠ ç›´è§‚ï¼Œå¯è¯»æ€§é«˜ï¼

ï¼ˆ6ï¼‰å®Œå–„æœåŠ¡ç«¯

```java
package cn.stazxr;

import java.io.IOException;
import java.io.InputStream;
import java.net.InetSocketAddress;
import java.net.ServerSocket;
import java.net.Socket;

public class Server {

    public static final Map<String,Socket> USERS = new ConcurrentHashMap<>();

    @SuppressWarnings("all")
    public static void main(String[] args) throws IOException, ClassNotFoundException {
        // åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨
        ServerSocket serverSocket = new ServerSocket();
        // ç»‘å®šç«¯å£
        serverSocket.bind(new InetSocketAddress(8888));
        System.out.println("æœåŠ¡å™¨å·²ç»å¯åŠ¨ï¼Œåœ¨8888ç«¯å£ï¼");
        // å¼€å§‹ç›‘å¬
        Socket socket = serverSocket.accept();
        InputStream inputStream = socket.getInputStream();
        ObjectInputStream ois = new ObjectInputStream(inputStream);
        Message message = (Message) ois.readObject());
        System.out.println(message);
    }
}

```

è®©æˆ‘ä»¬ä¾æ¬¡è¿è¡ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ¥æµ‹è¯•ä¸€ä¸‹

![image-20231003234742320](./img/image-20231003234742320.png)

æ¶ˆæ¯è¢«æ‰“å°å‡ºæ¥äº†ï¼

### 2.ç»“æ„ä¼˜åŒ–

ç°åœ¨æˆ‘ä»¬è¿˜æ²¡æœ‰å¤„ç†å¼‚å¸¸ï¼Œå¹¶ä¸”æ•´ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ä»£ç ååˆ†å†—ä½™ï¼Œæœªæ¥try-catchä¼šå¾ˆä¹±ï¼æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»£ç åº”è¯¥å°½é‡åªä¿ç•™ä¸šåŠ¡é€»è¾‘ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨æ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€çš„é€»è¾‘ç‹¬ç«‹èµ·æ¥ï¼ŒæŠŠå®ƒä»¬åŒ…è£…æˆä¸€ä¸ªå·¥å…·ç±»ï¼

ï¼ˆ1ï¼‰æ–°å»ºcn\.stazxr\.utilçš„åŒ…

ï¼ˆ2ï¼‰æ–°å»ºä¸€ä¸ªMsgUtilså·¥å…·ç±»

```java
package cn.stazxr.util;

import cn.stazxr.Message;

import java.io.IOException;
import java.io.InputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.io.OutputStream;
import java.util.Optional;

public class MsgUtils {

    // ä»æµä¸­è¯»å–msg
    public static Optional<Message> readMsg(InputStream inputStream) {
        ObjectInputStream ois;
        try {
            ois = new ObjectInputStream(inputStream);
            // å°è£…æˆä¸€ä¸ªoptionalï¼Œå°†æ¥å¤–ç•Œä½¿ç”¨å°±å¯ä»¥é¿å…ç©ºæŒ‡é’ˆ
            return Optional.ofNullable((Message) ois.readObject());
        } catch (IOException | ClassNotFoundException e) {
            e.printStackTrace();
        }
        return Optional.empty();
    }

    // å‘è¾“å‡ºæµå†™æ¶ˆæ¯
    public static void writeMsg(OutputStream outputStream,Message message) {
        ObjectOutputStream oos;
        try {
            oos = new ObjectOutputStream(outputStream);
            oos.writeObject(message);
            oos.flush();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

}
```

è¯»å–æ¶ˆæ¯æ—¶ï¼Œä¸ºäº†é¿å…ä»£ç æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨[Optional](https://zhuanlan.zhihu.com/p/580961892)ç±»å†åŒ…è£…ä¸€å±‚ã€‚

æœåŠ¡ç«¯

```java
public class Server {

    public static final Map<String,Socket> USERS = new ConcurrentHashMap<>();

    public static void main(String[] args) throws IOException, ClassNotFoundException {
        // åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨
        ServerSocket serverSocket = new ServerSocket();
        // ç»‘å®šç«¯å£
        serverSocket.bind(new InetSocketAddress(8888));
        System.out.println("æœåŠ¡å™¨å·²ç»å¯åŠ¨ï¼Œåœ¨8888ç«¯å£ï¼");
        // å¼€å§‹ç›‘å¬
        Socket socket = serverSocket.accept();
        InputStream inputStream = socket.getInputStream();
        Optional<Message> message = MsgUtils.readMsg(inputStream);
        // Optionalæ¶ˆè´¹ä¿¡æ¯
        message.ifPresent(System.out::println);
    }
}
```

å®¢æˆ·ç«¯

```java
/**
 * åŠŸèƒ½ï¼š1ã€ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯  2ã€ç»™å¥½å‹å‘æ¶ˆæ¯  3ã€ç¾¤å‘æ¶ˆæ¯
 * 1ã€ç”¨ä»€ä¹ˆç±»å‹å‘æ¶ˆæ¯
 */
public class Client {

    public static void main(String[] args) throws IOException {
        Socket socket = new Socket();
        // é“¾æ¥æœåŠ¡å™¨
        socket.connect(new InetSocketAddress(8888));
        // å‘æ¶ˆæ¯
        OutputStream outputStream = socket.getOutputStream();

        MsgUtils.writeMsg(outputStream,new Message(MessageType.TO_SERVER,"hello"));

        outputStream.close();
    }

}
```

ç„¶åå…ˆç”¨`while(true)`åŒ…ä¸€ä¸‹ï¼Œè®©æœåŠ¡ç«¯ä¸€ç›´ç›‘å¬ç«¯å£

```java
@SuppressWarnings("all")
public static void main(String[] args) throws IOException, ClassNotFoundException {
    // åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨
    ServerSocket serverSocket = new ServerSocket();
    // ç»‘å®šç«¯å£
    serverSocket.bind(new InetSocketAddress(8888));
    System.out.println("æœåŠ¡å™¨å·²ç»å¯åŠ¨ï¼Œåœ¨8888ç«¯å£ï¼");
    // å¼€å§‹ç›‘å¬
    while (true){
        Socket socket = serverSocket.accept();
        InputStream inputStream = socket.getInputStream();
        Optional<Message> message = MsgUtils.readMsg(inputStream);
        message.ifPresent(System.out::println);
    }
}
```

æµ‹è¯•ä¸€ä¸‹ï¼š

![image-20231004000752263](./img/image-20231004000752263.png)

æ¯è¿è¡Œä¸€æ¬¡å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯è¿™è¾¹å°±æ‰“å°ä¸€æ¡æ¶ˆæ¯

### 3.å¤šç”¨æˆ·ç»´æŠ¤

æ¯ä¸ªç”¨æˆ·éƒ½éœ€è¦ç”¨æˆ·åå’Œå¯†ç 

ä¸ºäº†è®©æœåŠ¡çŸ¥é“ç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ‘ä»¬ç»™Messageç±»å†æ·»åŠ ä¸¤ä¸ªå±æ€§ã€‚

```java
// ç”¨æ¥ç™»å½•
private String username;
private String password;

private String friendUesrName;
```

**é‡æ–°å†™getterå’Œsetterï¼**

**é‡æ–°å†™toString()ï¼**

æ„é€ å™¨ä¹Ÿè¦é‡å†™

```java
public Message() {
}
public Message(Integer type, String content, String username) {
    this.type = type;
    this.content = content;
    this.username = username;
}
public Message(Integer type, String content, String username, String friendUesrName) {
    this.type = type;
    this.content = content;
    this.username = username;
    this.friendUesrName = friendUesrName;
}
```

æœåŠ¡ç«¯å¯ä»¥ç”¨mapå­˜ä¸€ä¸‹ç”¨æˆ·

`public static final Map<String,Socket> ONLINE_USERS = new ConcurrentHashMap<>();`

ç°åœ¨ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥åŠ ä¸Šç”¨æˆ·åäº†

```java
// å…ˆç™»å½•
MsgUtils.writeMsg(outputStream,new Message(MessageType.TO_SERVER,"hello","lucy"));
```

æ¶ˆæ¯çš„ç±»å‹å¯ä»¥åŠ ä¸€ä¸ªç™»å½•çš„æ¶ˆæ¯

```java
package cn.stazxr.constant;

public class MessageType {
    public static final int LOGIN = 4;
    public static final int TO_SERVER = 1;
    public static final int TO_FRIEND = 2;
    public static final int TO_ALL = 3;
    public static final int FROM_SERVER = 5;
}
```

å’±ä»¬è¿˜å¯ä»¥ä¸ºç”¨æˆ·ç™»å½•ä¸“é—¨çš„æ„é€ å™¨ã€‚

```java
// ç™»å½•çš„æ„é€ å™¨
public Message(String username, String password,Integer type) {
    this.type = type;
    this.username = username;
    this.password = password;
}
```

ä½†æ˜¯åœ¨è¿™é‡Œæˆ‘ä»¬ä¸ä½¿ç”¨è¿™ä¸ªè¿™ç§æ–¹å¼ï¼Œå› ä¸ºç™»å½•çš„æ¶ˆæ¯æ¯”è¾ƒç‰¹æ®Šï¼Œæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å•ç‹¬å°è£…ä¸€ä¸ªæ–¹æ³•ã€‚

æˆ‘ä»¬å…ˆæµ‹è¯•ä¸€ä¸‹ï¼š

ç°åœ¨ï¼Œæˆ‘ä»¬çš„Serverç±»å·²ç»æ”¹å†™æˆè¿™æ ·ï¼š

```java
public class Server {

    // å­˜ç™»å½•çš„ç”¨æˆ·
    public static final Map<String, Socket> ONLINE_USERS = new ConcurrentHashMap<>();

    @SuppressWarnings("all")
    public static void main(String[] args) throws IOException, ClassNotFoundException {
        // åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨
        ServerSocket serverSocket = new ServerSocket();
        // ç»‘å®šç«¯å£
        serverSocket.bind(new InetSocketAddress(8888));
        System.out.println("æœåŠ¡å™¨å·²ç»å¯åŠ¨ï¼Œåœ¨8888ç«¯å£ï¼");
        // å¼€å§‹ç›‘å¬
        while (true) {
            Socket socket = serverSocket.accept();
            InputStream inputStream = socket.getInputStream();
            OutputStream outputStream = socket.getOutputStream();
            Optional<Message> message = MsgUtils.readMsg(inputStream);
            // åˆ¤æ–­ç™»å½•çš„é€»è¾‘
            if (!message.isPresent() || message.get().getUsername() == null || !message.get().getPassword().equals("123456")) {
                MsgUtils.writeMsg(outputStream, new Message(MessageType.FROM_SERVER, "ç™»å½•å¤±è´¥ï¼", "server"));
                continue;
            } else {
                Message msg = message.get();
                // éªŒè¯æˆåŠŸæ”¾å…¥åœ¨çº¿ç”¨æˆ·mapä¸­
                ONLINE_USERS.put(msg.getUsername(),socket);
                System.out.println(msg.getUsername() + "ç™»å½•æˆåŠŸï¼");
                MsgUtils.writeMsg(outputStream, new Message(MessageType.FROM_SERVER, "ç™»å½•æˆåŠŸï¼", "server"));
            }
        }
    }
}
```

Clientç±»æ”¹å†™æˆäº†è¿™æ ·ï¼š

```java
package cn.stazxr;
/**
 * åŠŸèƒ½ï¼š1ã€ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯  2ã€ç»™å¥½å‹å‘æ¶ˆæ¯  3ã€ç¾¤å‘æ¶ˆæ¯
 * 1ã€ç”¨ä»€ä¹ˆç±»å‹å‘æ¶ˆæ¯
 */
public class Client {

    public static void main(String[] args) throws IOException {
        Socket socket = new Socket();
        // é“¾æ¥æœåŠ¡å™¨
        socket.connect(new InetSocketAddress(8888));
        // å‘æ¶ˆæ¯
        OutputStream outputStream = socket.getOutputStream();

        // å…ˆç™»å½•
        Message message = new Message();
        message.setType(MessageType.LOGIN);
        message.setUsername("lucy");
        message.setPassword("123456");
        MsgUtils.writeMsg(outputStream, message);

        outputStream.close();
    }

}
```

MessageTypeç±»

```java
package cn.stazxr.constant;

public class MessageType {
    public static final int TO_SERVER = 1;
    public static final int TO_FRIEND = 2;
    public static final int TO_ALL = 3;
    public static final int LOGIN = 4;
    public static final int FROM_SERVER = 5;
}
```

æˆ‘ä»¬è·‘ä¸€ä¸‹ï¼

![image-20231004193148234](./img/image-20231004193148234.png)

æŠ¥é”™äº†qwq

æˆ‘ä»¬è¿™é‡Œçš„æœåŠ¡ç«¯æŠ¥äº†**è¿æ¥è¢«æ‹’ç»**çš„å¼‚å¸¸

åŸå› æ˜¯æˆ‘ä»¬çš„å®¢æˆ·ç«¯æ²¡æœ‰`InputStream`å¯¹è±¡æ¥æ¥æ”¶æ¶ˆæ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æœåŠ¡ç«¯ç»™å®¢æˆ·ç«¯å‘é€ç™»å½•æˆåŠŸçš„æ¶ˆæ¯æ—¶ï¼Œå®¢æˆ·ç«¯æ ¹æœ¬æ²¡æ³•æ¥æ”¶ï¼

ç»™Clientç±»åŠ ä¸ŠInputStreamã€‚ã€‚ã€‚ğŸ˜

```java
/**
 * åŠŸèƒ½ï¼š1ã€ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯  2ã€ç»™å¥½å‹å‘æ¶ˆæ¯  3ã€ç¾¤å‘æ¶ˆæ¯
 * 1ã€ç”¨ä»€ä¹ˆç±»å‹å‘æ¶ˆæ¯
 */
public class Client {

    public static void main(String[] args) throws IOException {
        Socket socket = new Socket();
        // é“¾æ¥æœåŠ¡å™¨
        socket.connect(new InetSocketAddress(8888));
        // å‘æ¶ˆæ¯
        OutputStream outputStream = socket.getOutputStream();
        // æ”¶æ¶ˆæ¯
        InputStream inputStream = socket.getInputStream();

        // å…ˆç™»å½•
        Message message = new Message();
        message.setType(MessageType.LOGIN);
        message.setUsername("lucy");
        message.setPassword("123456");
        MsgUtils.writeMsg(outputStream, message);
        Optional<Message> msg = MsgUtils.readMsg(inputStream);
        msg.ifPresent(System.out::println);
        
        outputStream.close();
        socket.close();
    }

}
```

:fish:

å†æµ‹è¯•ä¸€ä¸‹ï¼

![image-20231004194819893](./img/image-20231004194819893.png)

![image-20231004194836435](./img/image-20231004194836435.png)

å®¢æˆ·ç«¯ç™»å½•æˆåŠŸï¼:smile:

#### å®¢æˆ·ç«¯å®Œå–„

æˆ‘ä»¬éœ€è¦è¦è®©å®¢æˆ·ç«¯èƒ½ä¸€ç›´ç»™æœåŠ¡ç«¯å‘æ¶ˆæ¯ã€‚

åŒ…ä¸€ä¸ªwhileå¾ªç¯ã€‚

```java
String username = null;
// å…ˆç™»å½•
while (true) {
    // å…ˆåˆ¤æ–­æœ‰æ²¡æœ‰ç™»å½•
    if (username == null){
        System.out.println("è¯·æ‚¨è¾“å…¥ç”¨æˆ·åï¼š");
        String name = ScannerUtil.input();
        System.out.println("è¯·æ‚¨è¾“å…¥å¯†ç ï¼š");
        String pwd = ScannerUtil.input();
        Message message = new Message();
        message.setType(MessageType.LOGIN);
        message.setUsername(name);
        message.setPassword(pwd);
        MsgUtils.writeMsg(outputStream, message);
        // æ¥æ”¶æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯
        Optional<Message> msg = MsgUtils.readMsg(inputStream);
        if (msg.isPresent() && msg.get().getContent().equals("ç™»å½•æˆåŠŸï¼")){
            username = name;
        }
    }
}
```

è¿™é‡Œæ–°å»ºäº†ä¸€ä¸ªå·¥å…·ç±»ï¼ˆScannerUtilï¼‰ï¼Œç”¨äºScannerã€‚

*ScannerUtil*

```java
package cn.stazxr.util;

import java.util.Scanner;

public class ScannerUtil {

    private static final Scanner scanner = new Scanner(System.in);

    public static String input(){
       return scanner.next();
    }

}
```

æ¬¸ï¼å¦‚æœæˆ‘ä»¬ä½¿ç”¨`msg.get().getContent().equals("ç™»å½•æˆåŠŸï¼")`æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸å¤ªå¥½

é¦–å…ˆæˆ‘ä»¬åº”è¯¥åè¿‡æ¥ä½¿ç”¨equalsåˆ¤æ–­å­—ç¬¦ä¸²ï¼š

`"ç™»å½•æˆåŠŸï¼".equals(msg.get().getContent())`

å…¶æ¬¡ï¼Œè¿™æ ·è¿˜æ˜¯æ„Ÿè§‰æœ‰ç‚¹ä¸å¤ªå¥½ï¼Œæˆ‘ä»¬å†å°è£…ä¸€ä¸ªå¸¸é‡ç±»

```java
package cn.stazxr.constant;

public class Constant {
    // æ‰€æœ‰æˆåŠŸçš„å¸¸é‡
    public static final String SUCCESS = "success";
    // æ‰€æœ‰å¤±è´¥çš„å¸¸é‡
    public static final String FAIL = "fail";

}
```

![image-20231004225308354](./img/image-20231004225308354.png)

![image-20231004225320004](./img/image-20231004225320004.png)

æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠå®¢æˆ·ç«¯whileå¾ªç¯é‡Œé¢çš„ä»£ç æŠ½ç¦»å‡ºæ¥

åŒ…è£…æˆä¸€ä¸ªæ–¹æ³•

```java
// ç™»å½•çš„æ–¹æ³•
private static String login(OutputStream outputStream, InputStream inputStream) {
    System.out.println("è¯·æ‚¨è¾“å…¥ç”¨æˆ·åï¼š");
    String name = ScannerUtil.input();
    System.out.println("è¯·æ‚¨è¾“å…¥å¯†ç ï¼š");
    String pwd = ScannerUtil.input();
    Message message = new Message();
    message.setType(MessageType.LOGIN);
    message.setUsername(name);
    message.setPassword(pwd);
    // å‘é€ç»™æœåŠ¡å™¨
    MsgUtils.writeMsg(outputStream, message);
    // æ¥æ”¶æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯
    Optional<Message> msg = MsgUtils.readMsg(inputStream);
    if (msg.isPresent() && Constant.SUCCESS.equals(msg.get().getContent())) {
        return name;
    }
    return null;
}
```

```java
// è¡¨ç¤ºå½“å‰ç™»å½•çš„ç”¨æˆ·
String username = null;
// å…ˆç™»å½•
while (true) {
    // å…ˆåˆ¤æ–­æœ‰æ²¡æœ‰ç™»å½•
    if (username == null) {
        username = login(outputStream, inputStream);
    } else {
        // éç™»å½•çš„æƒ…å†µ
    }
}
```

æ¥ä¸‹æ¥å¯¹Clientè¿›è¡Œå¤§é‡çš„æ–¹æ³•æŠ½ç¦»ï¼Œæˆ‘ä»¬çš„Clientæœ€ç»ˆå˜æˆäº†è¿™ä¸ªæ ·å­ï¼š

```java
public class Client {

    public static void main(String[] args) throws IOException {
        Socket socket = new Socket();
        // é“¾æ¥æœåŠ¡å™¨
        socket.connect(new InetSocketAddress(8888));
        // å‘æ¶ˆæ¯
        OutputStream outputStream = socket.getOutputStream();
        // æ”¶æ¶ˆæ¯
        InputStream inputStream = socket.getInputStream();

        // è¡¨ç¤ºå½“å‰ç™»å½•çš„ç”¨æˆ·
        String username = null;
        // å…ˆç™»å½•
        while (true) {
            // å…ˆåˆ¤æ–­æœ‰æ²¡æœ‰ç™»å½•
            if (username == null) {
                username = login(outputStream, inputStream);
            } else {
                // æ‰“å°èœå•
                printOrder();
                String input = ScannerUtil.input();
                switch (Integer.parseInt(input)) {
                    case MessageType.TO_SERVER:
                        sendToServer(username,outputStream, inputStream);
                        break;
                    case MessageType.TO_FRIEND:
                        sendToFriend(username,outputStream, inputStream);
                        break;
                    case MessageType.TO_ALL:
                        sendToAll(username,outputStream, inputStream);
                        break;
                    default:
                        break;
                }
            }
        }
    }

    private static void sendToAll(String username, OutputStream outputStream, InputStream inputStream) {

    }

    private static void sendToFriend(String username, OutputStream outputStream, InputStream inputStream) {

    }

    private static void sendToServer(String username, OutputStream outputStream, InputStream inputStream) {
        System.out.println("è¯·è¾“å…¥è¦å‘é€çš„æ¶ˆæ¯ï¼š");
    }

    private static void printOrder() {
        System.out.println("è¯·æ‚¨é€‰æ‹©åŠŸèƒ½ï¼š" +
                MessageType.TO_SERVER + "ã€ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯ " +
                MessageType.TO_FRIEND + "ã€ç»™å¥½å‹å‘æ¶ˆæ¯ " +
                MessageType.TO_ALL + "ã€ç¾¤å‘æ¶ˆæ¯ ");
    }

    // ç™»å½•çš„æ–¹æ³•
    private static String login(OutputStream outputStream, InputStream inputStream) {
        System.out.println("è¯·æ‚¨è¾“å…¥ç”¨æˆ·åï¼š");
        String name = ScannerUtil.input();
        System.out.println("è¯·æ‚¨è¾“å…¥å¯†ç ï¼š");
        String pwd = ScannerUtil.input();
        Message message = new Message();
        message.setType(MessageType.LOGIN);
        message.setUsername(name);
        message.setPassword(pwd);
        // å‘é€ç»™æœåŠ¡å™¨
        MsgUtils.writeMsg(outputStream, message);
        // æ¥æ”¶æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯
        Optional<Message> msg = MsgUtils.readMsg(inputStream);
        if (msg.isPresent() && Constant.SUCCESS.equals(msg.get().getContent())) {
            return name;
        }
        return null;
    }
}
```

æœåŠ¡å™¨ä¹Ÿä¸€æ ·

```java
public class Server {

    // å­˜ç™»å½•çš„ç”¨æˆ·
    public static final Map<String, Socket> ONLINE_USERS = new ConcurrentHashMap<>();

    @SuppressWarnings("all")
    public static void main(String[] args) throws IOException, ClassNotFoundException {
        // åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨
        ServerSocket serverSocket = new ServerSocket();
        // ç»‘å®šç«¯å£
        serverSocket.bind(new InetSocketAddress(8888));
        System.out.println("æœåŠ¡å™¨å·²ç»å¯åŠ¨ï¼Œåœ¨8888ç«¯å£ï¼");
        // å¼€å§‹ç›‘å¬
        while (true) {
            Socket socket = serverSocket.accept();
            InputStream inputStream = socket.getInputStream();
            OutputStream outputStream = socket.getOutputStream();
            Optional<Message> message = MsgUtils.readMsg(inputStream);
            if (message.isPresent()) {
                Message msg = message.get();
                switch (msg.getType()) {
                    case MessageType.LOGIN:
                        loginHandler(inputStream, outputStream, msg, socket);
                        break;
                    case MessageType.TO_SERVER:
                        sendToClient(inputStream, outputStream, msg);
                        break;
                    case MessageType.TO_FRIEND:
                        sendToTarger(inputStream, outputStream, msg);
                        break;
                    case MessageType.TO_ALL:
                        sendToAll(inputStream, outputStream, msg);
                        break;
                }
            }
        }
    }

    private static void sendToAll(InputStream inputStream, OutputStream outputStream, Message message) {

    }

    private static void sendToTarger(InputStream inputStream, OutputStream outputStream, Message message) {

    }

    private static void sendToClient(InputStream inputStream, OutputStream outputStream, Message message) {

    }

    private static void loginHandler(InputStream inputStream, OutputStream outputStream, Message message, Socket socket) {
        // åˆ¤æ–­ç™»å½•çš„é€»è¾‘
        if (message.getUsername() == null || !message.getPassword().equals("123456")) {
            MsgUtils.writeMsg(outputStream, new Message(MessageType.FROM_SERVER, Constant.FAIL, "server"));
        } else {
            // éªŒè¯æˆåŠŸæ”¾å…¥åœ¨çº¿ç”¨æˆ·mapä¸­
            ONLINE_USERS.put(message.getUsername(), socket);
            System.out.println(message.getUsername() + "ç™»å½•æˆåŠŸï¼");
            MsgUtils.writeMsg(outputStream, new Message(MessageType.FROM_SERVER, Constant.SUCCESS, "server"));
        }
    }
}
```

### 4.åŠŸèƒ½å®ç°

#### ï¼ˆ1ï¼‰ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯

å®¢æˆ·ç«¯

```java
// ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯
private static void sendToServer(String username, OutputStream outputStream, InputStream inputStream) {
    System.out.print(username + ": ");
    String msg = ScannerUtil.input();
    MsgUtils.writeMsg(outputStream,new Message(MessageType.TO_SERVER,username,msg));
    // æ¥æ”¶æ¶ˆæ¯
    Optional<Message> massage = MsgUtils.readMsg(inputStream);
    massage.ifPresent(m -> System.out.println(m.getUsername() + "ï¼š" + m.getContent()));
}
```

æœåŠ¡å™¨

å…ˆæ·»åŠ å‡ ä¸ªå¸¸é‡ãƒ¾(â€¢Ï‰â€¢`)o

```java
package cn.stazxr.constant;

public class Constant {
    // æ‰€æœ‰æˆåŠŸçš„å¸¸é‡
    public static final String SUCCESS = "success";
    // æ‰€æœ‰å¤±è´¥çš„å¸¸é‡
    public static final String FAIL = "fail";

    public static final String DEFAULT_PASSWORD = "123456";

    public static final String SERVER_NAME = "server";
    public static final String OK = "OK!";

}
```

æŠŠèƒ½æ›¿æ¢çš„éƒ½æ›¿æ¢äº†ã€‚

```java
private static void sendToClient(InputStream inputStream, OutputStream outputStream, Message message) {
    // æ¥æ”¶æ¶ˆæ¯å¹¶æ‰“å°
    System.out.println(message.getUsername() + "ï¼š" + message.getContent());
    MsgUtils.writeMsg(outputStream,new Message(MessageType.TO_SERVER,Constant.OK,Constant.SERVER_NAME));
}
```

> æµ‹è¯•ï¼š

![image-20231005001141427](./img/image-20231005001141427.png)

![image-20231005001202653](./img/image-20231005001202653.png)

#### ï¼ˆ2ï¼‰ç»™å¥½å‹å‘æ¶ˆæ¯

åœ¨å¤šç”¨æˆ·çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨å¤šçº¿ç¨‹å¤„ç†

æ–°å»ºServerThreadç±»ï¼Œç»§æ‰¿Threadã€‚

æŠŠæœåŠ¡ç«¯çš„ä»£ç ç²˜è´´åˆ°é‡å†™çš„`run()`æ–¹æ³•é‡Œé¢ã€‚

```java
package cn.stazxr;

import cn.stazxr.constant.Constant;
import cn.stazxr.constant.MessageType;
import cn.stazxr.util.MsgUtils;

import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.Socket;
import java.util.Optional;

public class ServerThread extends Thread {

    private Socket socket;

    public ServerThread() {
    }

    public ServerThread(Socket socket) {
        this.socket = socket;
    }

    @Override
    public void run() {
        try (InputStream inputStream = socket.getInputStream();
             OutputStream outputStream = socket.getOutputStream()) {
            while (true) {
                Optional<Message> message = MsgUtils.readMsg(inputStream);
                if (message.isPresent()) {
                    Message msg = message.get();
                    switch (msg.getType()) {
                        case MessageType.LOGIN:
                            loginHandler(inputStream, outputStream, msg, socket);
                            break;
                        case MessageType.TO_SERVER:
                            sendToClient(inputStream, outputStream, msg);
                            break;
                        case MessageType.TO_FRIEND:
                            sendToTarger(inputStream, outputStream, msg);
                            break;
                        case MessageType.TO_ALL:
                            sendToAll(inputStream, outputStream, msg);
                            break;
                    }
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }

    }

    private void sendToAll(InputStream inputStream, OutputStream outputStream, Message message) {

    }

    private void sendToTarger(InputStream inputStream, OutputStream outputStream, Message message) {

    }

    private void sendToClient(InputStream inputStream, OutputStream outputStream, Message message) {
        // æ¥æ”¶æ¶ˆæ¯å¹¶æ‰“å°
        System.out.println(message.getUsername() + "ï¼š" + message.getContent());
        MsgUtils.writeMsg(outputStream, new Message(MessageType.TO_SERVER, Constant.OK, Constant.SERVER_NAME));
    }

    private void loginHandler(InputStream inputStream, OutputStream outputStream, Message message, Socket socket) {
        // åˆ¤æ–­ç™»å½•çš„é€»è¾‘
        if (message.getUsername() == null || !Constant.DEFAULT_PASSWORD.equals(message.getPassword())) {
            MsgUtils.writeMsg(outputStream, new Message(MessageType.FROM_SERVER, Constant.FAIL, Constant.SERVER_NAME));
        } else {
            // éªŒè¯æˆåŠŸæ”¾å…¥åœ¨çº¿ç”¨æˆ·mapä¸­
            Constant.ONLINE_USERS.put(message.getUsername(), socket);
            System.out.println(message.getUsername() + "ç™»å½•æˆåŠŸï¼");
            MsgUtils.writeMsg(outputStream, new Message(MessageType.FROM_SERVER, Constant.SUCCESS, Constant.SERVER_NAME));
        }
    }
}
```

æœåŠ¡å™¨

```java
package cn.stazxr;

import java.io.IOException;
import java.net.InetSocketAddress;
import java.net.ServerSocket;
import java.net.Socket;

public class Server {

    public static void main(String[] args) {
        try (// åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨
             ServerSocket serverSocket = new ServerSocket();) {
            // ç»‘å®šç«¯å£
            serverSocket.bind(new InetSocketAddress(8888));
            System.out.println("æœåŠ¡å™¨å·²ç»å¯åŠ¨ï¼Œåœ¨8888ç«¯å£ï¼");
            // å¼€å§‹ç›‘å¬
            // å»ºç«‹ä¸€ä¸ªè¿æ¥
            while (true) {
                Socket socket = serverSocket.accept();
                new ServerThread(socket).start();
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

}
```

åœ¨ideaä¸­ï¼Œæˆ‘ä»¬æŠŠ*Allow multiple instances*çš„å‹¾å‹¾ä¸Šï¼Œè®©å®ƒå¯ä»¥è¿è¡Œå¤šä¸ªå®¢æˆ·ç«¯å®ä¾‹ã€‚

![image-20231005170950698](./img/image-20231005170950698.png)

![image-20231005170747155](./img/image-20231005170747155.png)

ç„¶åæˆ‘ä»¬è¿è¡Œæµ‹è¯•ä¸€ä¸‹ï¼

> æœåŠ¡ç«¯

![image-20231005171030277](./img/image-20231005171030277.png)

> å®¢æˆ·ç«¯1

![image-20231005171130083](./img/image-20231005171130083.png)

> å®¢æˆ·ç«¯2

![image-20231005171140377](./img/image-20231005171140377.png)

æ¥ç€æˆ‘ä»¬ç»§ç»­å®ç°ç»™å¥½å‹å‘æ¶ˆæ¯

*Client*

```java
private static void sendToFriend(String username, OutputStream outputStream, InputStream inputStream) {
    System.out.print("è¯·è¾“å…¥å¥½å‹çš„åå­—ï¼š");
    String friend = ScannerUtil.input();
    boolean flag = true;
    while (flag){
        System.out.print(username + "ï¼š");
        String msg = ScannerUtil.input();
        if ("bye".equals(msg)) {
            flag = false;
        }
        MsgUtils.writeMsg(outputStream, new Message(MessageType.TO_FRIEND, msg, username, friend));
          // æ¥æ”¶æ¶ˆæ¯
          Optional<Message> massage = MsgUtils.readMsg(inputStream);
          massage.ifPresent(m -> System.out.println(m.getUsername() + "ï¼š" + m.getContent()));
    }
}
private static void receiverMsg(InputStream inputStream) {
    while (true){
        Optional<Message> msg = MsgUtils.readMsg(inputStream);
        msg.ifPresent(m -> System.out.println(m.getUsername() + "ï¼š" + m.getContent()));
    }
}
```

*ServerThread*

```java
// ç»™ç›®æ ‡ç”¨æˆ·å‘é€æ¶ˆæ¯
private void sendToTarger(Message message) {
    // å…ˆæ‰¾åˆ°å¯¹åº”çš„socket
    Socket socket = Constant.ONLINE_USERS.get(message.getFriendUesrName());
    try {
        MsgUtils.writeMsg(socket.getOutputStream(), message);
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

> ç»“æœ

![image-20231005173943263](./img/image-20231005173943263.png)

![image-20231005173932728](./img/image-20231005173932728.png)

#### ï¼ˆ3ï¼‰ç¾¤å‘æ¶ˆæ¯

*ServerThread*

```java
private void sendToAll(Message message) {
    // éå†æ‰€æœ‰åœ¨çº¿çš„ç”¨æˆ·
    for (Map.Entry<String, Socket> entry : Constant.ONLINE_USERS.entrySet()) {
        try {
            MsgUtils.writeMsg(entry.getValue().getOutputStream(), message);
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }
}
```

*Client*

```java
private static void sendToAll(String username, OutputStream outputStream, InputStream inputStream) {
    boolean flag = true;
    while (flag) {
        System.out.print(username + "ï¼š");
        String msg = ScannerUtil.input();
        if ("bye".equals(msg)) {
            flag = false;
        }
        MsgUtils.writeMsg(outputStream, new Message(MessageType.TO_ALL, msg, username));
    }
}
```

![image-20231005210637811](./img/image-20231005210637811.png)

![image-20231005210648653](./img/image-20231005210648653.png)

![image-20231005210659423](./img/image-20231005210659423.png)

### é™„å®Œå–„ä»£ç ï¼š

é¡¹ç›®ç»“æ„ï¼š

> ![image-20231005211023618](./img/image-20231005211023618.png)

*Client*

::: details ç‚¹å‡»æŸ¥çœ‹ä»£ç 

```java
package cn.stazxr;

import cn.stazxr.*;

import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.*;
import java.util.*;

/**
 * åŠŸèƒ½ï¼š1ã€ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯  2ã€ç»™å¥½å‹å‘æ¶ˆæ¯  3ã€ç¾¤å‘æ¶ˆæ¯
 * 1ã€ç”¨ä»€ä¹ˆç±»å‹å‘æ¶ˆæ¯
 */
public class Client {

    public static void main(String[] args) throws IOException {
        Socket socket = new Socket();
        // é“¾æ¥æœåŠ¡å™¨
        socket.connect(new InetSocketAddress(8888));
        // å‘æ¶ˆæ¯
        OutputStream outputStream = socket.getOutputStream();
        // æ”¶æ¶ˆæ¯
        InputStream inputStream = socket.getInputStream();
        boolean flag = true;
        // è¡¨ç¤ºå½“å‰ç™»å½•çš„ç”¨æˆ·
        String username = null;
        // å…ˆç™»å½•
        while (flag) {
            // å…ˆåˆ¤æ–­æœ‰æ²¡æœ‰ç™»å½•
            if (username == null) {
                username = login(outputStream, inputStream);
            } else {
                // æ‰“å°èœå•
                printOrder();
                String input = ScannerUtil.input();
                switch (Integer.parseInt(input)) {
                    case MessageType.TO_SERVER:
                        sendToServer(username, outputStream, inputStream);
                        break;
                    case MessageType.TO_FRIEND:
                        sendToFriend(username, outputStream, inputStream);
                        break;
                    case MessageType.TO_ALL:
                        sendToAll(username, outputStream);
                        break;
                    case MessageType.RECEIVER:
                        receiverMsg(inputStream);
                        break;
                    default:
                        lostConnection(username,outputStream);
                        flag = false;
                }
            }
        }
        MsgUtils.readMsg(inputStream).ifPresent(msg -> {
            System.out.println(msg.getContent());
        });
        inputStream.close();
        outputStream.close();
        socket.close();
    }

    private static void lostConnection(String username, OutputStream outputStream) {
        MsgUtils.writeMsg(outputStream, new Message(MessageType.LOST_CONNECTION,Constant.BYE,username));
    }

    private static void receiverMsg(InputStream inputStream) {
        AtomicBoolean flag = new AtomicBoolean(true);
        while (flag.get()) {
            Optional<Message> msg = MsgUtils.readMsg(inputStream);
            msg.ifPresent(m -> {
                System.out.println(m.getUsername() + "ï¼š" + m.getContent());
                if (Constant.BYE.equals(m.getContent())){
                    flag.set(false);
                }
            });
        }
    }

    private static void sendToAll(String username, OutputStream outputStream) {
        boolean flag = true;
        while (flag) {
            System.out.print(username + "ï¼š");
            String msg = ScannerUtil.input();
            if (Constant.BYE.equals(msg)) {
                flag = false;
            }
            MsgUtils.writeMsg(outputStream, new Message(MessageType.TO_ALL, msg, username));
        }
    }

    private static void sendToFriend(String username, OutputStream outputStream, InputStream inputStream) {
        System.out.print("è¯·è¾“å…¥å¥½å‹çš„åå­—ï¼š");
        String friend = ScannerUtil.input();
        boolean flag = true;
        while (flag) {
            System.out.print(username + "ï¼š");
            String msg = ScannerUtil.input();
            if (Constant.BYE.equals(msg)) {
                flag = false;
            }
            MsgUtils.writeMsg(outputStream, new Message(MessageType.TO_FRIEND, msg, username, friend));
        }
    }

    // ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯
    private static void sendToServer(String username, OutputStream outputStream, InputStream inputStream) {
        System.out.print(username + "ï¼š");
        String msg = ScannerUtil.input();
        MsgUtils.writeMsg(outputStream, new Message(MessageType.TO_SERVER, msg, username));
        // æ¥æ”¶æ¶ˆæ¯
        Optional<Message> massage = MsgUtils.readMsg(inputStream);
        massage.ifPresent(m -> System.out.println(m.getUsername() + "ï¼š" + m.getContent()));
    }

    private static void printOrder() {
        System.out.println("è¯·æ‚¨é€‰æ‹©åŠŸèƒ½ï¼š" +
                MessageType.TO_SERVER + "ã€ç»™æœåŠ¡å™¨å‘æ¶ˆæ¯ " +
                MessageType.TO_FRIEND + "ã€ç»™å¥½å‹å‘æ¶ˆæ¯ " +
                MessageType.TO_ALL + "ã€ç¾¤å‘æ¶ˆæ¯ " +
                MessageType.RECEIVER + "ã€æ¥æ”¶ä¿¡æ¯ å…¶ä»–ã€é€€å‡º");
    }

    // ç™»å½•çš„æ–¹æ³•
    private static String login(OutputStream outputStream, InputStream inputStream) {
        System.out.println("è¯·æ‚¨è¾“å…¥ç”¨æˆ·åï¼š");
        String name = ScannerUtil.input();
        System.out.println("è¯·æ‚¨è¾“å…¥å¯†ç ï¼š");
        String pwd = ScannerUtil.input();
        Message message = new Message();
        message.setType(MessageType.LOGIN);
        message.setUsername(name);
        message.setPassword(pwd);
        // å‘é€ç»™æœåŠ¡å™¨
        MsgUtils.writeMsg(outputStream, message);
        // æ¥æ”¶æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯
        Optional<Message> msg = MsgUtils.readMsg(inputStream);
        if (msg.isPresent() && Constant.SUCCESS.equals(msg.get().getContent())) {
            return name;
        }
        msg.ifPresent(m -> System.out.println(m.getContent()));
        return null;
    }

}
```

:::

*Message*

::: details ç‚¹å‡»æŸ¥çœ‹ä»£ç 

```java
package cn.stazxr;

import java.io.Serial;
import java.io.Serializable;

public class Message implements Serializable {

    @Serial
    private static final long serialVersionUID = 8327856103560598769L;

    private Integer type;
    private String content;
    // ç”¨æ¥ç™»å½•
    private String username;
    private String password;

    private String friendUesrName;

    public Message() {
    }

    /*// ç™»å½•çš„æ„é€ å™¨
    public Message(String username, String password,Integer type) {
        this.type = type;
        this.username = username;
        this.password = password;
    }*/

    public Message(Integer type, String content, String username) {
        this.type = type;
        this.content = content;
        this.username = username;
    }

    public Message(Integer type, String content, String username, String friendUesrName) {
        this.type = type;
        this.content = content;
        this.username = username;
        this.friendUesrName = friendUesrName;
    }

    public Integer getType() {
        return type;
    }

    public void setType(Integer type) {
        this.type = type;
    }

    public String getContent() {
        return content;
    }

    public void setContent(String content) {
        this.content = content;
    }

    public String getUsername() {
        return username;
    }

    public void setUsername(String username) {
        this.username = username;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public String getFriendUesrName() {
        return friendUesrName;
    }

    public void setFriendUesrName(String friendUesrName) {
        this.friendUesrName = friendUesrName;
    }

    @Override
    public String toString() {
        return "Message{" +
                "type=" + type +
                ", content='" + content + '\'' +
                ", username='" + username + '\'' +
                ", password='" + password + '\'' +
                ", friendUesrName='" + friendUesrName + '\'' +
                '}';
    }
}
```

:::

*Server*

::: details ç‚¹å‡»æŸ¥çœ‹ä»£ç 

```java
package cn.stazxr;

import java.io.IOException;
import java.net.InetSocketAddress;
import java.net.ServerSocket;
import java.net.Socket;

public class Server {

    public static void main(String[] args) {
        try (// åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨
             ServerSocket serverSocket = new ServerSocket();) {
            // ç»‘å®šç«¯å£
            serverSocket.bind(new InetSocketAddress(8888));
            System.out.println("æœåŠ¡å™¨å·²ç»å¯åŠ¨ï¼Œåœ¨8888ç«¯å£ï¼");
            // å¼€å§‹ç›‘å¬
            // å»ºç«‹ä¸€ä¸ªè¿æ¥
            while (true) {
                Socket socket = serverSocket.accept();
                new ServerThread(socket).start();
            }
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }

}
```

:::

*ServerThread*

::: details ç‚¹å‡»æŸ¥çœ‹ä»£ç 

```java
package cn.stazxr;

public class ServerThread extends Thread {

    private Socket socket;

    public ServerThread() {
    }

    public ServerThread(Socket socket) {
        this.socket = socket;
    }

    @Override
    public void run() {
        boolean flag = true;
        try (InputStream inputStream = socket.getInputStream();
             OutputStream outputStream = socket.getOutputStream()) {
            while (flag) {
                Optional<Message> message = MsgUtils.readMsg(inputStream);
                if (message.isPresent()) {
                    Message msg = message.get();
                    switch (msg.getType()) {
                        case MessageType.LOGIN:
                            loginHandler(inputStream, outputStream, msg, socket);
                            break;
                        case MessageType.TO_SERVER:
                            sendToClient(inputStream, outputStream, msg);
                            break;
                        case MessageType.TO_FRIEND:
                            sendToTarger(msg);
                            break;
                        case MessageType.TO_ALL:
                            sendToAll(msg);
                            break;
                        case MessageType.LOST_CONNECTION:
                            message.ifPresent(m -> {
                                System.out.println(m.getUsername() + "ä¸‹çº¿äº†");
                                try {
                                    MsgUtils.writeMsg(Constant.ONLINE_USERS.get(m.getUsername()).getOutputStream(), new Message(MessageType.FROM_SERVER, Constant.OFFLINE, m.getUsername()));
                                } catch (IOException e) {
                                    e.printStackTrace();
                                }
                                Constant.ONLINE_USERS.remove(m.getUsername());
                            });
                            flag = false;
                            break;
                    }
                }
            }
        } catch (IOException e) {
            throw new RuntimeException();
        }

    }

    private void sendToAll(Message message) {
        // éå†æ‰€æœ‰åœ¨çº¿çš„ç”¨æˆ·
        for (Map.Entry<String, Socket> entry : Constant.ONLINE_USERS.entrySet()) {
            if (entry.getKey().equals(message.getUsername())) continue;
            try {
                MsgUtils.writeMsg(entry.getValue().getOutputStream(), message);
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }

    // ç»™ç›®æ ‡ç”¨æˆ·å‘é€æ¶ˆæ¯
    private void sendToTarger(Message message) {
        // å…ˆæ‰¾åˆ°å¯¹åº”çš„socket
        Socket socket = Constant.ONLINE_USERS.get(message.getFriendUesrName());
        try {
            MsgUtils.writeMsg(socket.getOutputStream(), message);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    private void sendToClient(InputStream inputStream, OutputStream outputStream, Message message) {
        // æ¥æ”¶æ¶ˆæ¯å¹¶æ‰“å°
        System.out.println(message.getUsername() + "ï¼š" + message.getContent());
        MsgUtils.writeMsg(outputStream, new Message(MessageType.TO_SERVER, Constant.OK, Constant.SERVER_NAME));
    }

    private void loginHandler(InputStream inputStream, OutputStream outputStream, Message message, Socket socket) {
        // åˆ¤æ–­ç™»å½•çš„é€»è¾‘
        if (Constant.ONLINE_USERS.containsKey(message.getUsername())) {
            MsgUtils.writeMsg(outputStream, new Message(MessageType.FROM_SERVER, "å·²ç»ç™»å½•äº†", Constant.SERVER_NAME));
            return;
        }
        if (message.getUsername() == null || !Constant.DEFAULT_PASSWORD.equals(message.getPassword())) {
            MsgUtils.writeMsg(outputStream, new Message(MessageType.FROM_SERVER, Constant.FAIL, Constant.SERVER_NAME));
        } else {
            // éªŒè¯æˆåŠŸæ”¾å…¥åœ¨çº¿ç”¨æˆ·mapä¸­
            Constant.ONLINE_USERS.put(message.getUsername(), socket);
            System.out.println(message.getUsername() + "ç™»å½•æˆåŠŸï¼");
            MsgUtils.writeMsg(outputStream, new Message(MessageType.FROM_SERVER, Constant.SUCCESS, Constant.SERVER_NAME));
        }
    }
}
```

:::

*Constant*

::: details ç‚¹å‡»æŸ¥çœ‹ä»£ç 

```java
package cn.stazxr.constant;

import java.net.Socket;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

public class Constant {
    // æ‰€æœ‰æˆåŠŸçš„å¸¸é‡
    public static final String SUCCESS = "success";
    // æ‰€æœ‰å¤±è´¥çš„å¸¸é‡
    public static final String FAIL = "fail";

    public static final String DEFAULT_PASSWORD = "123456";

    public static final String SERVER_NAME = "server";
    public static final String OK = "OK!";
    public static final String BYE = "bye";

    // å­˜ç™»å½•çš„ç”¨æˆ·
    public static final Map<String, Socket> ONLINE_USERS = new ConcurrentHashMap<>();
    public static final String OFFLINE = "å·²æ–­å¼€è¿æ¥ï¼";
}
```

:::

*MessageType*

::: details ç‚¹å‡»æŸ¥çœ‹ä»£ç 

```java
package cn.stazxr.constant;

public class MessageType {
    public static final int LOGIN = 8;
    public static final int TO_SERVER = 1;
    public static final int TO_FRIEND = 2;
    public static final int TO_ALL = 3;
    public static final int RECEIVER = 4;
    public static final int FROM_SERVER = 5;
    public static final int LOST_CONNECTION = 6;
}
```

:::

*MsgUtils*

::: details ç‚¹å‡»æŸ¥çœ‹ä»£ç 

```java
package cn.stazxr.util;

import cn.stazxr.Message;

import java.io.IOException;
import java.io.InputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.io.OutputStream;
import java.util.Optional;

public class MsgUtils {

    // ä»æµä¸­è¯»å–msg
    public static Optional<Message> readMsg(InputStream inputStream) {
        ObjectInputStream ois;
        try {
            ois = new ObjectInputStream(inputStream);
            // å°è£…æˆä¸€ä¸ªoptionalï¼Œå°†æ¥å¤–ç•Œä½¿ç”¨å°±å¯ä»¥é¿å…ç©ºæŒ‡é’ˆ
            return Optional.ofNullable((Message) ois.readObject());
        } catch (IOException | ClassNotFoundException e) {
            e.printStackTrace();
        }
        return Optional.empty();
    }

    // å‘è¾“å‡ºæµå†™æ¶ˆæ¯
    public static void writeMsg(OutputStream outputStream,Message message) {
        ObjectOutputStream oos;
        try {
            oos = new ObjectOutputStream(outputStream);
            oos.writeObject(message);
            oos.flush();
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }

}
```

:::

*ScannerUtil*

::: details ç‚¹å‡»æŸ¥çœ‹ä»£ç 

```java
package cn.stazxr.util;

import java.util.Scanner;

public class ScannerUtil {

    private static final Scanner scanner = new Scanner(System.in);

    public static String input(){
       return scanner.next();
    }

}
```

:::
